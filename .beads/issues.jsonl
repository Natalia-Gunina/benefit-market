{"id":"benefit-market-09b","title":"UI/UX дизайн-система","description":"Дизайн-система проекта: цветовая палитра, типографика, компоненты shadcn/ui, макеты ключевых экранов. Должна быть готова до начала разработки UI.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-25T21:50:58.885888+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:49.399214+03:00","closed_at":"2026-02-25T22:19:49.399214+03:00","close_reason":"Дизайн-система полностью готова: spec + код"}
{"id":"benefit-market-09b.1","title":"Дизайн-спецификация: цветовая палитра и типографика","description":"Определить и задокументировать в docs/DESIGN.md:\n\n1. Цветовая палитра:\n   - Primary: основной цвет бренда (для кнопок, ссылок, акцентов).\n   - Secondary: дополнительный цвет.\n   - Semantic: success (зелёный), warning (жёлтый), error (красный), info (синий).\n   - Статусы заказов: reserved (amber), paid (emerald), cancelled (slate), expired (rose).\n   - Транзакции ledger: accrual (green), spend (red), reserve (amber), release (blue), expire (gray).\n   - Нейтральные: background, surface, border, muted, foreground.\n   - Тёмная тема: все цвета с dark mode вариантами.\n\n2. Типографика:\n   - Выбрать 2 Google Fonts: display (заголовки) + body (текст).\n   - НЕ Inter, НЕ Roboto, НЕ Arial — что-то с характером.\n   - Type scale: h1-h6, body-lg, body, body-sm, caption.\n   - Задокументировать font-weight для каждого уровня.\n\n3. CSS переменные и tailwind.config.ts расширение.\n\nAcceptance: файл docs/DESIGN.md с точными hex-кодами, CSS variables, Tailwind config snippet.","status":"closed","priority":0,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:58:01.577339+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:11:38.050563+03:00","closed_at":"2026-02-25T22:11:38.050563+03:00","close_reason":"Спецификация создана в docs/DESIGN.md (2047 строк)","dependencies":[{"issue_id":"benefit-market-09b.1","depends_on_id":"benefit-market-09b","type":"parent-child","created_at":"2026-02-25T21:58:01.58096+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-09b.2","title":"Дизайн-спецификация: компоненты и паттерны","description":"Описать визуальный дизайн ключевых компонентов:\n\n1. Sidebar Navigation — стиль (тёмный/светлый), иконки, active state, hover, collapsed (mobile).\n2. Header Bar — информация о пользователе, баланс баллов (pill badge), название компании.\n3. Benefit Card — для каталога: layout, иконка/изображение, название, цена в баллах (badge), категория (tag).\n4. Status Badge — цветовое кодирование для каждого статуса заказа.\n5. Wallet Balance — крупное отображение баллов, available/reserved/total.\n6. Transaction Row — иконка типа + сумма + цвет + описание.\n7. Data Table — стиль для HR/admin (zebra stripes?, header, sorting arrows, фильтры).\n8. Metric Card — большая цифра + label + опционально sparkline/trend arrow.\n9. Charts — стилизация recharts: цвета серий, tooltip, grid, legend.\n10. Form Inputs — border style, focus ring, validation (error/success), label placement.\n11. Buttons — primary, secondary, outline, ghost, destructive. Размеры: sm, md, lg.\n12. Toast — success/error/warning стили, анимация входа/выхода.\n13. Empty State — иллюстрация + сообщение + CTA кнопка.\n14. File Upload Zone — drag \u0026 drop area для CSV импорта.\n15. Modal/Dialog — overlay, размеры, анимация.\n\nДля каждого компонента: описание + какой shadcn/ui компонент в основе + кастомизация.\n\nAcceptance: секция в docs/DESIGN.md с описанием каждого компонента.","status":"closed","priority":0,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:58:06.774112+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:11:38.118668+03:00","closed_at":"2026-02-25T22:11:38.118668+03:00","close_reason":"Спецификация создана в docs/DESIGN.md (2047 строк)","dependencies":[{"issue_id":"benefit-market-09b.2","depends_on_id":"benefit-market-09b","type":"parent-child","created_at":"2026-02-25T21:58:06.775152+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-09b.3","title":"Дизайн-спецификация: layouts и wireframes ключевых экранов","description":"ASCII/текстовые wireframes для ключевых экранов:\n\nEMPLOYEE:\n1. Каталог льгот — grid 3 колонки (desktop), 1 колонка (mobile), поиск + фильтр сверху.\n2. Детальная страница льготы — hero + описание + sidebar с ценой и кнопкой.\n3. Корзина — список позиций + итого + кнопка оформления.\n4. Кошелёк — баланс card вверху + таблица транзакций.\n5. История заказов — таблица/список с фильтром.\n\nHR:\n6. Дашборд — 4 метрики вверху + 3 графика (bar, pie, line).\n7. Список сотрудников — таблица с поиском.\n8. Импорт CSV — зона загрузки + превью + результат.\n\nADMIN:\n9. CRUD таблица (универсальный паттерн) — header + фильтры + таблица + pagination.\n10. Форма создания/редактирования — модальное окно или drawer.\n\nДля каждого: описание layout, responsive поведение (desktop → tablet → mobile).\nSidebar: 256px desktop, overlay на mobile, иконки + labels.\n\nAcceptance: секция в docs/DESIGN.md с wireframes.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:58:13.071675+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:11:38.202707+03:00","closed_at":"2026-02-25T22:11:38.202707+03:00","close_reason":"Спецификация создана в docs/DESIGN.md (2047 строк)","dependencies":[{"issue_id":"benefit-market-09b.3","depends_on_id":"benefit-market-09b","type":"parent-child","created_at":"2026-02-25T21:58:13.072425+03:00","created_by":"ayugunin"},{"issue_id":"benefit-market-09b.3","depends_on_id":"benefit-market-09b.1","type":"blocks","created_at":"2026-02-25T22:04:58.395291+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-09b.4","title":"Настройка Tailwind + shadcn/ui theme","description":"Реализовать дизайн-систему в коде:\n\n1. tailwind.config.ts:\n   - Расширить colors с кастомной палитрой.\n   - Добавить fontFamily (Google Fonts).\n   - Настроить borderRadius, spacing если нужно.\n\n2. globals.css:\n   - CSS переменные для light/dark theme.\n   - @import Google Fonts.\n   - Базовые стили body, headings.\n\n3. shadcn/ui theme:\n   - components.json — настройка стиля (default или new-york).\n   - Кастомизация через CSS переменные (--primary, --secondary, --accent, etc).\n\n4. Добавить компоненты shadcn/ui которые понадобятся:\n   Card, Button, Input, Select, Table, Badge, Dialog, Sheet, Tabs, Skeleton, Toast, DropdownMenu, Avatar, Tooltip.\n\nAcceptance: запускается npm run dev, тема применяется корректно, dark mode переключается.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:58:14.727558+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:49.180568+03:00","closed_at":"2026-02-25T22:19:49.180568+03:00","close_reason":"Tailwind + shadcn/ui + дизайн-система настроены, 26 компонентов установлены","dependencies":[{"issue_id":"benefit-market-09b.4","depends_on_id":"benefit-market-09b","type":"parent-child","created_at":"2026-02-25T21:58:14.728262+03:00","created_by":"ayugunin"},{"issue_id":"benefit-market-09b.4","depends_on_id":"benefit-market-09b.1","type":"blocks","created_at":"2026-02-25T22:04:58.622887+03:00","created_by":"ayugunin"},{"issue_id":"benefit-market-09b.4","depends_on_id":"benefit-market-09b.2","type":"blocks","created_at":"2026-02-25T22:04:58.866914+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0","title":"Админ-панель и полировка","description":"Недели 7-8. Управление tenant'ами, каталогом, политиками и правилами. Аудит-лог, сгорание баллов (expiration cron), UI-полировка, адаптивность.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-25T21:50:55.004791+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.793112+03:00","closed_at":"2026-02-25T22:46:12.793112+03:00","close_reason":"Epic 4 полностью готов","dependencies":[{"issue_id":"benefit-market-1a0","depends_on_id":"benefit-market-94r","type":"blocks","created_at":"2026-02-25T21:55:13.317979+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.1","title":"API + UI: Управление tenant'ами","description":"Страница /dashboard/admin/tenants:\n\nAPI:\n- GET /api/admin/tenants — список tenant'ов с пагинацией.\n- POST /api/admin/tenants — создание нового tenant'а.\n- PATCH /api/admin/tenants/:id — обновление настроек.\n\nUI:\n- Таблица tenant'ов: название, домен, количество сотрудников, дата создания.\n- Модальное окно создания: name, domain, settings.\n- Редактирование в drawer/modal.\n- Доступ: только admin.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:54:19.377647+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.138952+03:00","closed_at":"2026-02-25T22:46:12.138952+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.1","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:19.378363+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.2","title":"API + UI: CRUD каталога льгот (админ)","description":"Страница /dashboard/admin/benefits:\n\nAPI:\n- GET /api/admin/benefits — все льготы (включая неактивные).\n- POST /api/admin/benefits — создание.\n- PATCH /api/admin/benefits/:id — обновление (название, цена, лимит, is_active).\n- DELETE /api/admin/benefits/:id — soft delete (is_active=false).\n- CRUD для benefit_categories.\n\nUI:\n- Таблица: название, категория, цена баллов, лимит, статус (вкл/выкл).\n- Toggle для is_active прямо в таблице.\n- Форма создания/редактирования: все поля + выбор категории.\n- Фильтр по категории и статусу.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:54:22.060993+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.198802+03:00","closed_at":"2026-02-25T22:46:12.198802+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.2","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:22.061618+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.3","title":"API + UI: CRUD budget policies","description":"Страница /dashboard/admin/policies:\n\nAPI:\n- GET /api/admin/policies — все политики tenant'а.\n- POST /api/admin/policies — создание.\n- PATCH /api/admin/policies/:id — обновление.\n- DELETE /api/admin/policies/:id — деактивация.\n\nUI:\n- Таблица: название, баллов, период, фильтр целевой группы, статус.\n- Форма: name, points_amount (числовой input), period (select: monthly/quarterly/yearly), target_filter (визуальный конструктор условий: grade, location, legal_entity — multi-select для каждого), is_active.\n- Предпросмотр: 'Попадает N сотрудников из M'.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:54:24.489911+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.262635+03:00","closed_at":"2026-02-25T22:46:12.262635+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.3","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:24.490552+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.4","title":"API + UI: CRUD eligibility rules","description":"Страница /dashboard/admin/rules (или inline в карточке льготы):\n\nAPI:\n- GET /api/admin/rules?benefit_id= — правила для льготы.\n- POST /api/admin/rules — создание.\n- PATCH /api/admin/rules/:id — обновление.\n- DELETE /api/admin/rules/:id — удаление.\n\nUI:\n- Конструктор условий: grade (multi-select), min_tenure (number), location (multi-select), legal_entity (multi-select).\n- Привязка к конкретной льготе (benefit_id).\n- Предпросмотр: 'Льгота доступна N из M сотрудников'.\n- Можно встроить прямо в форму редактирования льготы.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:27.067449+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.32834+03:00","closed_at":"2026-02-25T22:46:12.32834+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.4","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:27.068031+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.5","title":"API + UI: Управление пользователями и ролями","description":"Страница /dashboard/admin/users:\n\nAPI:\n- GET /api/admin/users — пользователи tenant'а с профилями.\n- PATCH /api/admin/users/:id — изменение роли.\n- POST /api/admin/users/invite — пригласить (создать запись + отправить email, или в MVP просто создать).\n\nUI:\n- Таблица: email, имя, роль, tenant, дата регистрации.\n- Быстрое изменение роли через select в строке.\n- Фильтр по роли и tenant'у.\n- Поиск по email/имени.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:31.357871+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.387293+03:00","closed_at":"2026-02-25T22:46:12.387293+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.5","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:31.358471+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.6","title":"API + UI: Аудит-лог","description":"Страница /dashboard/admin/audit:\n\nAPI:\n- GET /api/admin/audit-log — записи с пагинацией, фильтрацией.\n  Query: ?entity_type=, ?action=, ?user_id=, ?from=, ?to=, ?page=\n\nUI:\n- Таблица: дата/время, пользователь, действие, сущность, diff (expandable row).\n- Фильтры: по типу сущности, по действию, по дате.\n- diff показывать в формате 'было → стало' (JSON diff viewer).\n\nЗапись в audit_log — через database trigger или helper в API routes.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:32.479088+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.448488+03:00","closed_at":"2026-02-25T22:46:12.448488+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.6","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:32.479732+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.7","title":"Edge Function: Сгорание баллов (expiration cron)","description":"Supabase Edge Function + cron:\n\nЗапускается раз в день (00:05).\n\nАлгоритм:\n1. SELECT * FROM wallets WHERE expires_at \u003c now() AND balance \u003e 0.\n2. Для каждого expired wallet:\n   a. INSERT INTO point_ledger type='expire', amount = -balance.\n   b. UPDATE wallets SET balance = 0, reserved = 0.\n3. Логирование: количество expired кошельков, сумма сгоревших баллов.\n\nТест: создать wallet с expires_at в прошлом, запустить функцию, проверить ledger и balance.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:54:33.849103+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.508423+03:00","closed_at":"2026-02-25T22:46:12.508423+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.7","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:33.849926+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.8","title":"UI-полировка: адаптивность, ошибки, пустые состояния","description":"Финальная полировка UI:\n\n1. Адаптивность: все страницы корректно отображаются на 320px-1920px.\n2. Пустые состояния: иконка + текст + CTA для каждого списка (нет заказов, нет льгот, нет сотрудников).\n3. Обработка ошибок: toast-уведомления для API-ошибок, Error Boundary для компонентов.\n4. Loading states: skeleton для всех списков и карточек.\n5. 404 страница.\n6. Toast для успешных действий (заказ создан, импорт завершён).\n7. Confirmation dialogs для деструктивных действий.\n\nshadcn/ui: Toast, AlertDialog, Skeleton.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:54:36.584431+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.570396+03:00","closed_at":"2026-02-25T22:46:12.570396+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.8","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:36.585057+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a","title":"Фундамент: проект, схема БД, авторизация","description":"Недели 1-2. Инициализация проекта Next.js + Supabase, SQL-схема всех таблиц с RLS-политиками, аутентификация, каркас трёх кабинетов (employee/hr/admin), seed-данные.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-25T21:50:48.960381+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:23:34.909361+03:00","closed_at":"2026-02-25T22:23:34.909361+03:00","close_reason":"Фундамент полностью готов: проект, схема, auth, middleware, layouts, RLS, seed","dependencies":[{"issue_id":"benefit-market-73a","depends_on_id":"benefit-market-09b","type":"blocks","created_at":"2026-02-25T21:55:14.864257+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.1","title":"Инициализация Next.js 14 + TypeScript + Tailwind + shadcn/ui","description":"Создать проект Next.js 14 (App Router) с TypeScript strict mode. Установить Tailwind CSS, shadcn/ui. Настроить структуру папок:\n- app/(employee)/ — кабинет сотрудника\n- app/(hr)/ — кабинет HR\n- app/(admin)/ — кабинет админа\n- app/api/ — API routes\n- lib/ — утилиты, supabase client, types\n- components/ — переиспользуемые компоненты\n\nНастроить ESLint, Prettier. Добавить .env.local.example.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:52:15.645368+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.028374+03:00","closed_at":"2026-02-25T22:19:52.028374+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.1","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:15.646749+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.10","title":"Layout трёх кабинетов с навигацией","description":"Создать layout для каждого кабинета:\n\nEmployee layout:\n- Sidebar/header: Каталог, Мои заказы, Кошелёк, Профиль\n- Отображение баланса баллов в header\n\nHR layout:\n- Sidebar: Дашборд, Сотрудники, Импорт, Политики\n- Название компании в header\n\nAdmin layout:\n- Sidebar: Tenant'ы, Каталог, Политики, Правила, Пользователи, Аудит-лог\n- Индикатор выбранного tenant'а\n\nОбщее: тёмная/светлая тема, адаптивный sidebar (collapse на мобильных), breadcrumbs.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:52:45.931747+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.531313+03:00","closed_at":"2026-02-25T22:19:52.531313+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.10","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:45.932602+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.11","title":"Seed-данные: тестовый tenant, пользователи, льготы","description":"Создать seed-скрипт (supabase/seed.sql или scripts/seed.ts):\n\n1 tenant: ООО 'Тестовая компания'\n3 пользователя: employee@test.com, hr@test.com, admin@test.com\n5 employee_profiles с разными грейдами/локациями\n3 benefit_categories: Здоровье, Обучение, Спорт\n10 benefits с разными ценами и лимитами\n3 eligibility_rules\n2 budget_policies\nКошельки с начальным балансом для каждого сотрудника\n\nСкрипт должен быть идемпотентным (можно запускать повторно).","status":"closed","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:48.435778+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:23:34.693626+03:00","closed_at":"2026-02-25T22:23:34.693626+03:00","close_reason":"RLS-политики и seed-данные созданы","dependencies":[{"issue_id":"benefit-market-73a.11","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:48.43638+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.2","title":"Подключение Supabase (Auth + DB + Storage)","description":"Создать проект в Supabase. Настроить клиенты:\n- lib/supabase/client.ts — браузерный клиент\n- lib/supabase/server.ts — серверный клиент (cookies)\n- lib/supabase/admin.ts — service role клиент (для Edge Functions)\n\nНастроить Supabase Auth: email + пароль. Проверить flow регистрации и входа.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:18.941661+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.088394+03:00","closed_at":"2026-02-25T22:19:52.088394+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.2","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:18.942319+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.3","title":"SQL-схема: tenants, users, employee_profiles","description":"Создать миграцию Supabase с таблицами:\n\nCREATE TABLE tenants (id uuid PK, name text NOT NULL, domain text, settings jsonb DEFAULT '{}', created_at timestamptz DEFAULT now());\n\nCREATE TABLE users (id uuid PK, tenant_id uuid FK REFERENCES tenants, auth_id uuid FK REFERENCES auth.users, email text NOT NULL, role text CHECK (role IN ('employee','hr','admin')), created_at timestamptz DEFAULT now());\n\nCREATE TABLE employee_profiles (id uuid PK, user_id uuid FK REFERENCES users, tenant_id uuid FK REFERENCES tenants, grade text, tenure_months int, location text, legal_entity text, extra jsonb DEFAULT '{}');\n\nИндексы на tenant_id для каждой таблицы. UNIQUE(auth_id) на users.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":60,"created_at":"2026-02-25T21:52:23.881811+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.148421+03:00","closed_at":"2026-02-25T22:19:52.148421+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.3","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:23.8825+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.4","title":"SQL-схема: benefits, benefit_categories, eligibility_rules","description":"Создать миграцию с таблицами каталога:\n\nbenefit_categories (id, tenant_id FK, name, icon, sort_order)\nbenefits (id, tenant_id FK, category_id FK, name, description, price_points int, stock_limit int nullable, is_active boolean DEFAULT true, created_at)\neligibility_rules (id, benefit_id FK, tenant_id FK, conditions jsonb)\n\nconditions — JSONB с фильтрами: {grade: ['senior','middle'], min_tenure: 6, location: ['Moscow']}\nИндексы: benefits(tenant_id, is_active), eligibility_rules(benefit_id).","status":"closed","priority":1,"issue_type":"task","estimated_minutes":60,"created_at":"2026-02-25T21:52:28.387747+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.211787+03:00","closed_at":"2026-02-25T22:19:52.211787+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.4","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:28.388386+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.5","title":"SQL-схема: wallets, point_ledger, budget_policies","description":"Создать миграцию с таблицами кошельков:\n\nwallets (id, user_id FK, tenant_id FK, balance int DEFAULT 0, reserved int DEFAULT 0, period text e.g. '2025-Q1', expires_at timestamptz)\nCHECK (balance \u003e= 0), CHECK (reserved \u003e= 0)\nUNIQUE(user_id, period)\n\npoint_ledger (id, wallet_id FK, tenant_id FK, order_id FK nullable, type text CHECK IN ('accrual','reserve','spend','release','expire'), amount int NOT NULL, description text, created_at DEFAULT now())\nAppend-only: никаких UPDATE/DELETE.\n\nbudget_policies (id, tenant_id FK, name, points_amount int, period text CHECK IN ('monthly','quarterly','yearly'), target_filter jsonb, is_active boolean DEFAULT true)","status":"closed","priority":1,"issue_type":"task","estimated_minutes":60,"created_at":"2026-02-25T21:52:33.310512+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.282134+03:00","closed_at":"2026-02-25T22:19:52.282134+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.5","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:33.311115+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.6","title":"SQL-схема: orders, order_items, audit_log","description":"Создать миграцию:\n\norders (id, user_id FK, tenant_id FK, status text CHECK IN ('pending','reserved','paid','cancelled','expired'), total_points int, reserved_at timestamptz, expires_at timestamptz, created_at DEFAULT now())\n\norder_items (id, order_id FK, benefit_id FK, quantity int DEFAULT 1, price_points int)\n\naudit_log (id, tenant_id FK, user_id FK, action text, entity_type text, entity_id uuid, diff jsonb, created_at DEFAULT now())\n\nИндексы: orders(user_id, status), orders(tenant_id, status), orders(status, expires_at) для TTL cron.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":60,"created_at":"2026-02-25T21:52:36.219869+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.345194+03:00","closed_at":"2026-02-25T22:19:52.345194+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.6","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:36.220444+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.7","title":"RLS-политики для всех таблиц","description":"Включить RLS на всех таблицах. Создать политики:\n\ntenants: admin видит все, остальные — только свой tenant.\nusers: admin — все, hr — свой tenant, employee — только себя.\nemployee_profiles: hr/admin — свой tenant, employee — только себя.\nbenefits: все роли — свой tenant + is_active (employee), admin — все.\nbenefit_categories: все роли — свой tenant.\neligibility_rules: admin — свой tenant.\nbudget_policies: hr/admin — свой tenant.\nwallets: employee — только свои, hr/admin — свой tenant.\npoint_ledger: INSERT только через service_role. SELECT: employee — свои, hr/admin — свой tenant.\norders: employee — свои, hr/admin — свой tenant.\norder_items: через join с orders.\naudit_log: admin — свой tenant.\n\nJWT содержит tenant_id и role в app_metadata.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:52:39.804753+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:23:34.633422+03:00","closed_at":"2026-02-25T22:23:34.633422+03:00","close_reason":"RLS-политики и seed-данные созданы","dependencies":[{"issue_id":"benefit-market-73a.7","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:39.805382+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.8","title":"Supabase Auth: JWT custom claims (role, tenant_id)","description":"Настроить Supabase Auth hook или database function для добавления custom claims в JWT:\n- tenant_id — из таблицы users\n- role — из таблицы users\n\nСоздать функцию:\nCREATE OR REPLACE FUNCTION auth.custom_access_token_hook(event jsonb) RETURNS jsonb\nКоторая добавляет в token claims из таблицы users по auth.uid().\n\nЭто критично — без claims RLS-политики не работают.\nТестировать: зарегистрировать пользователя, проверить JWT в jwt.io.","status":"closed","priority":0,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:52:41.894556+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.407873+03:00","closed_at":"2026-02-25T22:19:52.407873+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.8","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:41.895161+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.9","title":"Middleware: route protection по ролям","description":"Создать middleware.ts в корне проекта:\n- Проверять наличие сессии Supabase Auth.\n- Извлекать role из JWT.\n- Маршруты /dashboard/employee/* — только employee.\n- Маршруты /dashboard/hr/* — только hr, admin.\n- Маршруты /dashboard/admin/* — только admin.\n- /auth/* — доступ без аутентификации.\n- Редирект неавторизованных на /auth/login.\n- Редирект при недостаточных правах на страницу своего кабинета.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:43.668667+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.468205+03:00","closed_at":"2026-02-25T22:19:52.468205+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.9","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:43.669236+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r","title":"Заказы, HR-кабинет и импорт","description":"Недели 5-6. Корзина, оформление заказов с резервом баллов, подтверждение/отмена, TTL резервов, CSV-импорт сотрудников, HR-дашборд с графиками на recharts.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-25T21:50:52.04065+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.973016+03:00","closed_at":"2026-02-25T22:39:17.973016+03:00","close_reason":"Epic 3 полностью готов","dependencies":[{"issue_id":"benefit-market-94r","depends_on_id":"benefit-market-ivk","type":"blocks","created_at":"2026-02-25T21:55:13.095569+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.1","title":"API: POST /api/orders — создание заказа с резервом баллов","description":"Next.js API route POST /api/orders:\n\nBody: { items: [{ benefit_id, quantity }] }\nДоступ: employee.\n\nАлгоритм:\n1. Валидация Zod: items не пуст, quantity \u003e 0.\n2. Проверить eligibility для каждой льготы.\n3. Проверить stock_limit (если есть).\n4. Рассчитать total_points = SUM(price_points * quantity).\n5. Проверить wallet.balance - wallet.reserved \u003e= total_points.\n6. В транзакции:\n   a. Создать order (status=reserved, reserved_at=now(), expires_at=now()+15min).\n   b. Создать order_items.\n   c. Создать point_ledger записи type=reserve.\n   d. Увеличить wallet.reserved на total_points.\n7. Вернуть order с items.\n\nОшибки: insufficient_points, benefit_not_available, stock_exceeded.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:53:29.847499+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.160027+03:00","closed_at":"2026-02-25T22:39:17.160027+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.1","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:29.848085+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.10","title":"UI: HR-дашборд на recharts","description":"Страница /dashboard/hr:\n\nКарточки-метрики вверху:\n- Общий бюджет / Потрачено / Утилизация %\n- Всего сотрудников / Активных\n\nГрафики (recharts):\n- BarChart: топ-5 популярных льгот.\n- PieChart: распределение по категориям.\n- LineChart/AreaChart: динамика начислений/списаний по месяцам.\n\nResponsive: на мобильных графики в 1 колонку.\nSkeleton loading для каждого блока.\n\nКомпоненты: MetricCard, BenefitPopularityChart, CategoryPieChart, TrendChart.\nshadcn/ui Card + recharts.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:53:53.061968+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.749176+03:00","closed_at":"2026-02-25T22:39:17.749176+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.10","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:53.062647+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.2","title":"API: POST /api/orders/:id/confirm — подтверждение заказа","description":"Next.js API route POST /api/orders/:id/confirm:\n\nДоступ: employee (только свои заказы).\n\nАлгоритм:\n1. Найти order по id, проверить принадлежность user_id.\n2. Проверить status = 'reserved'.\n3. Проверить expires_at \u003e now() (не истёк).\n4. В транзакции:\n   a. order.status = 'paid'.\n   b. Создать point_ledger type=spend (отрицательная запись).\n   c. Уменьшить wallet.balance на total_points.\n   d. Уменьшить wallet.reserved на total_points.\n   e. Если есть stock_limit — уменьшить stock.\n5. Записать в audit_log.\n\nОшибки: order_not_found, order_expired, invalid_status.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:53:32.482789+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.226926+03:00","closed_at":"2026-02-25T22:39:17.226926+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.2","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:32.483396+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.3","title":"API: POST /api/orders/:id/cancel — отмена заказа","description":"Next.js API route POST /api/orders/:id/cancel:\n\nДоступ: employee (только свои заказы).\n\nАлгоритм:\n1. Найти order по id, проверить user_id.\n2. Проверить status = 'reserved' (paid нельзя отменить в MVP).\n3. В транзакции:\n   a. order.status = 'cancelled'.\n   b. Создать point_ledger type=release.\n   c. Уменьшить wallet.reserved на total_points.\n4. Записать в audit_log.\n\nОшибки: order_not_found, cannot_cancel_paid.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:53:34.667668+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.293055+03:00","closed_at":"2026-02-25T22:39:17.293055+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.3","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:34.668249+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.4","title":"UI: Корзина и оформление заказа","description":"Реализовать flow покупки:\n\n1. Корзина (client-side state, zustand или context):\n   - Добавление/удаление льгот.\n   - Изменение количества.\n   - Отображение суммы в баллах.\n   - Сравнение с доступным балансом.\n   - Persist в localStorage.\n\n2. Страница /dashboard/employee/cart:\n   - Список позиций с ценами.\n   - Итого баллов.\n   - Предупреждение если баллов не хватает.\n   - Кнопка 'Оформить заказ' → POST /api/orders.\n   - После создания → переход на страницу заказа.\n\n3. Страница /dashboard/employee/orders/:id:\n   - Статус заказа (reserved/paid/cancelled/expired).\n   - Таймер TTL (осталось X минут на подтверждение).\n   - Кнопки: 'Подтвердить', 'Отменить' (если reserved).\n\nshadcn/ui: Card, Button, Badge, Alert.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":240,"created_at":"2026-02-25T21:53:37.962804+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.353434+03:00","closed_at":"2026-02-25T22:39:17.353434+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.4","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:37.963405+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.5","title":"UI: История заказов сотрудника","description":"Страница /dashboard/employee/orders:\n\n- Список заказов: дата, статус, сумма баллов, количество позиций.\n- Фильтр по статусу (все / активные / завершённые).\n- Сортировка по дате (новые первые).\n- Клик → детали заказа.\n- Статус-бейджи с цветовым кодированием:\n  reserved — жёлтый, paid — зелёный, cancelled — серый, expired — красный.\n\nAPI: GET /api/orders (с пагинацией, фильтром по статусу).","status":"closed","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:53:40.07787+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.416481+03:00","closed_at":"2026-02-25T22:39:17.416481+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.5","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:40.078495+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.6","title":"Edge Function: TTL резервов (cron)","description":"Supabase Edge Function + pg_cron:\n\nЗапускается каждые 5 минут.\n\nАлгоритм:\n1. SELECT * FROM orders WHERE status = 'reserved' AND expires_at \u003c now().\n2. Для каждого expired order:\n   a. UPDATE orders SET status = 'expired'.\n   b. INSERT INTO point_ledger type = 'release'.\n   c. UPDATE wallets SET reserved = reserved - order.total_points.\n3. Логирование: сколько заказов expired.\n\nАльтернатива pg_cron: Supabase Edge Function вызываемая через cron.supabase.com или Vercel cron.\n\nТест: создать заказ, подождать TTL, проверить что баллы вернулись.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:53:42.471808+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.477426+03:00","closed_at":"2026-02-25T22:39:17.477426+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.6","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:42.472511+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.7","title":"API: POST /api/import/employees — CSV-импорт","description":"Next.js API route POST /api/import/employees:\n\nДоступ: hr.\nContent-Type: multipart/form-data (файл CSV).\n\nФормат CSV:\nemail,name,grade,tenure_months,location,legal_entity\n\nАлгоритм:\n1. Парсинг CSV (papaparse).\n2. Валидация каждой строки через Zod.\n3. Для каждой валидной строки:\n   a. Upsert в users по email + tenant_id (создать если нет).\n   b. Upsert в employee_profiles.\n   c. Если новый сотрудник — создать wallet с balance = 0.\n4. Вернуть отчёт: { created: N, updated: N, errors: [{row: N, error: '...'}] }.\n\nЛимит: 1000 строк за раз. Обработка дубликатов email.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:53:45.2027+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.539969+03:00","closed_at":"2026-02-25T22:39:17.539969+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.7","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:45.203365+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.8","title":"UI: Страница импорта сотрудников","description":"Страница /dashboard/hr/import:\n\n1. Drag \u0026 drop зона для CSV файла (или кнопка выбора).\n2. Предпросмотр первых 5 строк перед импортом.\n3. Кнопка 'Импортировать'.\n4. Progress indicator во время загрузки.\n5. Результат: сводка (создано / обновлено / ошибки).\n6. Таблица ошибок: строка, поле, описание ошибки.\n7. Ссылка на скачивание шаблона CSV.\n\nshadcn/ui: Card, Table, Alert, Progress, Button.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:53:47.738115+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.604458+03:00","closed_at":"2026-02-25T22:39:17.604458+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.8","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:47.738839+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.9","title":"API: GET /api/reports/dashboard — данные HR-дашборда","description":"Next.js API route GET /api/reports/dashboard:\n\nДоступ: hr, admin.\n\nВозвращает агрегированные данные для tenant'а:\n1. Утилизация бюджета: total_accrued, total_spent, utilization_pct.\n2. Топ-5 популярных льгот: benefit_name, order_count, total_points.\n3. Активность сотрудников: total_employees, active (\u003e=1 заказ), inactive.\n4. Распределение по категориям: category_name, spent_points, pct.\n5. Динамика по месяцам (последние 6): month, accrued, spent.\n\nВсе запросы через SQL с группировкой. Кэширование не нужно для MVP.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:53:50.212598+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.685624+03:00","closed_at":"2026-02-25T22:39:17.685624+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.9","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:50.216263+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg","title":"Тестирование и деплой","description":"Недели 9-10. E2E тесты (Playwright), базовое нагрузочное тестирование, документация для защиты, деплой демо-стенда.","status":"in_progress","priority":2,"issue_type":"epic","created_at":"2026-02-25T21:50:56.264555+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:18.142527+03:00","dependencies":[{"issue_id":"benefit-market-hwg","depends_on_id":"benefit-market-1a0","type":"blocks","created_at":"2026-02-25T21:55:13.523472+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.1","title":"E2E тесты: авторизация и роли","description":"Playwright E2E тесты:\n\n1. Регистрация нового пользователя.\n2. Вход с email + пароль.\n3. Редирект employee на /dashboard/employee.\n4. Редирект HR на /dashboard/hr.\n5. Редирект admin на /dashboard/admin.\n6. Employee не может открыть /dashboard/admin → редирект.\n7. HR не может открыть /dashboard/admin → редирект.\n8. Неавторизованный → /auth/login.\n\nFixtures: тестовые пользователи из seed-данных.\nCI: запуск на GitHub Actions.","status":"open","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:38.806164+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:38.806164+03:00","dependencies":[{"issue_id":"benefit-market-hwg.1","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:38.806836+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.2","title":"E2E тесты: покупка льготы (happy path)","description":"Playwright E2E тесты:\n\n1. Войти как employee.\n2. Открыть каталог, увидеть доступные льготы.\n3. Кликнуть на льготу → детальная страница.\n4. Добавить в корзину.\n5. Перейти в корзину, проверить итого.\n6. Оформить заказ → статус reserved.\n7. Подтвердить заказ → статус paid.\n8. Проверить баланс кошелька уменьшился.\n9. Проверить заказ в истории заказов.\n\nТест отмены:\n10. Создать заказ → cancel → баланс вернулся.","status":"open","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:42.067074+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:42.067074+03:00","dependencies":[{"issue_id":"benefit-market-hwg.2","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:42.067626+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.3","title":"E2E тесты: HR-импорт и дашборд","description":"Playwright E2E тесты:\n\n1. Войти как HR.\n2. Открыть страницу импорта.\n3. Загрузить тестовый CSV (fixtures/test-employees.csv).\n4. Проверить отчёт: N создано, M обновлено.\n5. Перейти в список сотрудников — новые сотрудники появились.\n6. Открыть дашборд — графики отображаются.\n7. Тест ошибок импорта: загрузить невалидный CSV → показать ошибки.","status":"open","priority":3,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:54:44.984435+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:44.984435+03:00","dependencies":[{"issue_id":"benefit-market-hwg.3","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:44.985068+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.4","title":"Нагрузочное тестирование (k6)","description":"Базовое нагрузочное тестирование с k6:\n\nСценарии:\n1. Каталог льгот: 100 VU, 30s — GET /api/benefits.\n2. Создание заказа: 50 VU, 30s — POST /api/orders.\n3. Смешанный: 100 VU (70% каталог, 20% заказы, 10% кошелёк), 60s.\n\nПроверки:\n- p95 \u003c 500ms.\n- Error rate \u003c 1%.\n- Нет deadlock'ов при параллельных заказах.\n\nОтчёт: summary в markdown для дипломной работы.","status":"open","priority":3,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:54:48.048772+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:48.048772+03:00","dependencies":[{"issue_id":"benefit-market-hwg.4","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:48.049368+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.5","title":"Документация для защиты диплома","description":"Подготовить:\n\n1. Обновить README.md по итогам реализации (актуализировать если что-то изменилось).\n2. Описание архитектурных решений и обоснования (для текста диплома):\n   - Почему Next.js + Supabase.\n   - Почему shared schema multi-tenancy.\n   - Почему point_ledger (event sourcing lite).\n   - Сравнение с аналогами.\n3. Скриншоты ключевых экранов.\n4. Результаты нагрузочного тестирования.\n5. Описание ограничений MVP и план развития.","status":"open","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:51.688842+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:51.688842+03:00","dependencies":[{"issue_id":"benefit-market-hwg.5","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:51.689603+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.6","title":"Деплой демо-стенда","description":"Развернуть рабочий демо:\n\n1. Деплой Next.js на Vercel (или аналог).\n2. Supabase project для демо (отдельный от dev).\n3. Seed-данные: тестовая компания, 20+ сотрудников, 15+ льгот.\n4. Тестовые учётные записи: employee / hr / admin (пароли в .env).\n5. README с инструкцией как зайти и протестировать.\n6. Проверить всё работает: регистрация, каталог, заказ, импорт, дашборд.","status":"open","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:53.717213+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:53.717213+03:00","dependencies":[{"issue_id":"benefit-market-hwg.6","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:53.717813+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk","title":"Каталог льгот и кошельки баллов","description":"Недели 3-4. Каталог льгот с фильтрацией по eligibility rules, кошельки сотрудников, система баллов (budget policies, accrual), отображение баланса и истории транзакций.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-25T21:50:50.294863+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.534035+03:00","closed_at":"2026-02-25T22:31:07.534035+03:00","close_reason":"Каталог и кошельки полностью готовы","dependencies":[{"issue_id":"benefit-market-ivk","depends_on_id":"benefit-market-73a","type":"blocks","created_at":"2026-02-25T21:55:12.874469+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.1","title":"API: GET /api/benefits — каталог с фильтрацией","description":"Next.js API route GET /api/benefits:\n\n1. Извлечь user_id и tenant_id из JWT.\n2. Загрузить employee_profile текущего пользователя.\n3. Запросить benefits WHERE tenant_id AND is_active = true.\n4. Для каждой льготы проверить eligibility_rules.conditions против профиля (grade, tenure, location).\n5. Вернуть отфильтрованный список с пагинацией.\n\nQuery params: ?category_id=, ?search=, ?page=, ?per_page=\nResponse: { data: Benefit[], meta: { page, per_page, total } }\n\nZod-схема для query params. Обработка ошибок.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:52:47.126773+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.216906+03:00","closed_at":"2026-02-25T22:31:07.216906+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.1","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:47.127379+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.2","title":"UI: Страница каталога льгот с карточками","description":"Страница /dashboard/employee/benefits:\n\n- Шапка: поисковая строка + фильтр по категориям (tabs или select).\n- Сетка карточек: изображение/иконка, название, краткое описание, цена в баллах, категория.\n- Состояния: загрузка (skeleton), пустой результат, ошибка.\n- Пагинация или infinite scroll.\n- Клик по карточке → переход на детальную страницу.\n- Компоненты: BenefitCard, BenefitGrid, CategoryFilter, SearchInput.\n\nИспользовать shadcn/ui Card, Input, Tabs, Skeleton.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:52:49.585866+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.277511+03:00","closed_at":"2026-02-25T22:31:07.277511+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.2","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:49.586489+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.3","title":"UI: Детальная страница льготы","description":"Страница /dashboard/employee/benefits/[id]:\n\n- Полное описание льготы (rich text или markdown).\n- Цена в баллах (крупно).\n- Оставшийся stock (если есть лимит).\n- Кнопка 'Добавить в корзину' / 'В корзине'.\n- Показать текущий баланс кошелька для контекста.\n- Хлебные крошки: Каталог \u003e Категория \u003e Льгота.\n- Состояние если льгота недоступна (eligibility не пройдена) — показать 'Недоступна' без кнопки.\n\nAPI: GET /api/benefits/:id","status":"closed","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:51.920249+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.282096+03:00","closed_at":"2026-02-25T22:31:07.282096+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.3","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:51.920912+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.4","title":"Движок eligibility rules","description":"Реализовать проверку eligibility в lib/eligibility.ts:\n\nФункция: checkEligibility(profile: EmployeeProfile, rules: EligibilityRule[]): boolean\n\nФормат conditions (JSONB):\n{\n  grade: ['senior', 'middle'],  // IN check\n  min_tenure: 6,                // \u003e= check\n  location: ['Moscow', 'SPb'],  // IN check\n  legal_entity: ['ООО Тест']    // IN check\n}\n\nЛогика: ВСЕ условия должны быть true (AND). Если conditions пуст — льгота доступна всем.\nЕсли у benefit нет eligibility_rules — доступна всем.\n\nUnit-тесты для всех комбинаций.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:54.161037+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.2842+03:00","closed_at":"2026-02-25T22:31:07.2842+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.4","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:54.161629+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.5","title":"API: GET /api/wallets/me — баланс и история","description":"Next.js API route GET /api/wallets/me:\n\n1. Извлечь user_id из JWT.\n2. Найти активный wallet (текущий период, expires_at \u003e now()).\n3. Вернуть: balance, reserved, available (balance - reserved), period, expires_at.\n4. Вместе с последними N записями из point_ledger.\n\nQuery params: ?include_history=true, ?history_limit=50\nResponse: { data: { balance, reserved, available, period, expires_at, history?: LedgerEntry[] } }\n\nЕсли кошелька нет — вернуть balance: 0.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:56.355386+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.286224+03:00","closed_at":"2026-02-25T22:31:07.286224+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.5","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:56.355963+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.6","title":"UI: Страница кошелька с историей транзакций","description":"Страница /dashboard/employee/wallet:\n\n- Крупный блок: текущий баланс, зарезервировано, доступно.\n- Дата сгорания баллов (expires_at).\n- Таблица/список транзакций: дата, тип (accrual/spend/reserve/release/expire), сумма (+/-), описание.\n- Цветовое кодирование: зелёный — начисление, красный — списание, серый — сгорание, жёлтый — резерв.\n- Фильтр по типу транзакции.\n\nКомпоненты: WalletBalance, TransactionList, TransactionRow.\nshadcn/ui: Card, Table, Badge.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:52:58.760139+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.288331+03:00","closed_at":"2026-02-25T22:31:07.288331+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.6","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:58.760881+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.7","title":"Budget policies: CRUD и применение","description":"Реализовать систему budget policies:\n\n1. Модель: budget_policies с target_filter (JSONB, аналогичен eligibility conditions).\n2. API для HR: просмотр политик своего tenant'а.\n3. Логика применения в lib/budget.ts:\n   - findApplicablePolicy(profile: EmployeeProfile, policies: BudgetPolicy[]): BudgetPolicy | null\n   - Если несколько подходят — берём с наибольшим points_amount (или приоритет).\n\nИспользуется в процессе начисления (accrual).","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:53:00.683069+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.291227+03:00","closed_at":"2026-02-25T22:31:07.291227+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.7","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:53:00.683664+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.8","title":"API: POST /api/wallets/accrual — начисление баллов","description":"Next.js API route POST /api/wallets/accrual:\n\nДоступ: hr, admin. Запускает начисление для всех сотрудников tenant'а.\n\nАлгоритм:\n1. Получить всех сотрудников tenant'а с employee_profiles.\n2. Получить активные budget_policies tenant'а.\n3. Для каждого сотрудника:\n   a. Найти подходящую policy (по target_filter).\n   b. Проверить: не было ли уже начисления за текущий период.\n   c. Если кошелька нет — создать (period = текущий квартал, expires_at = конец квартала).\n   d. Создать запись point_ledger type=accrual.\n   e. Увеличить wallets.balance.\n4. Всё в транзакции.\n\nResponse: { data: { processed: 50, accrued: 45, skipped: 5, errors: [] } }","status":"closed","priority":1,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:53:03.705651+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.293349+03:00","closed_at":"2026-02-25T22:31:07.293349+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.8","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:53:03.706284+03:00","created_by":"ayugunin"}]}
