{"id":"benefit-market-09b","title":"UI/UX дизайн-система","description":"Дизайн-система проекта: цветовая палитра, типографика, компоненты shadcn/ui, макеты ключевых экранов. Должна быть готова до начала разработки UI.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-25T21:50:58.885888+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:49.399214+03:00","closed_at":"2026-02-25T22:19:49.399214+03:00","close_reason":"Дизайн-система полностью готова: spec + код"}
{"id":"benefit-market-09b.1","title":"Дизайн-спецификация: цветовая палитра и типографика","description":"Определить и задокументировать в docs/DESIGN.md:\n\n1. Цветовая палитра:\n   - Primary: основной цвет бренда (для кнопок, ссылок, акцентов).\n   - Secondary: дополнительный цвет.\n   - Semantic: success (зелёный), warning (жёлтый), error (красный), info (синий).\n   - Статусы заказов: reserved (amber), paid (emerald), cancelled (slate), expired (rose).\n   - Транзакции ledger: accrual (green), spend (red), reserve (amber), release (blue), expire (gray).\n   - Нейтральные: background, surface, border, muted, foreground.\n   - Тёмная тема: все цвета с dark mode вариантами.\n\n2. Типографика:\n   - Выбрать 2 Google Fonts: display (заголовки) + body (текст).\n   - НЕ Inter, НЕ Roboto, НЕ Arial — что-то с характером.\n   - Type scale: h1-h6, body-lg, body, body-sm, caption.\n   - Задокументировать font-weight для каждого уровня.\n\n3. CSS переменные и tailwind.config.ts расширение.\n\nAcceptance: файл docs/DESIGN.md с точными hex-кодами, CSS variables, Tailwind config snippet.","status":"closed","priority":0,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:58:01.577339+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:11:38.050563+03:00","closed_at":"2026-02-25T22:11:38.050563+03:00","close_reason":"Спецификация создана в docs/DESIGN.md (2047 строк)","dependencies":[{"issue_id":"benefit-market-09b.1","depends_on_id":"benefit-market-09b","type":"parent-child","created_at":"2026-02-25T21:58:01.58096+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-09b.2","title":"Дизайн-спецификация: компоненты и паттерны","description":"Описать визуальный дизайн ключевых компонентов:\n\n1. Sidebar Navigation — стиль (тёмный/светлый), иконки, active state, hover, collapsed (mobile).\n2. Header Bar — информация о пользователе, баланс баллов (pill badge), название компании.\n3. Benefit Card — для каталога: layout, иконка/изображение, название, цена в баллах (badge), категория (tag).\n4. Status Badge — цветовое кодирование для каждого статуса заказа.\n5. Wallet Balance — крупное отображение баллов, available/reserved/total.\n6. Transaction Row — иконка типа + сумма + цвет + описание.\n7. Data Table — стиль для HR/admin (zebra stripes?, header, sorting arrows, фильтры).\n8. Metric Card — большая цифра + label + опционально sparkline/trend arrow.\n9. Charts — стилизация recharts: цвета серий, tooltip, grid, legend.\n10. Form Inputs — border style, focus ring, validation (error/success), label placement.\n11. Buttons — primary, secondary, outline, ghost, destructive. Размеры: sm, md, lg.\n12. Toast — success/error/warning стили, анимация входа/выхода.\n13. Empty State — иллюстрация + сообщение + CTA кнопка.\n14. File Upload Zone — drag \u0026 drop area для CSV импорта.\n15. Modal/Dialog — overlay, размеры, анимация.\n\nДля каждого компонента: описание + какой shadcn/ui компонент в основе + кастомизация.\n\nAcceptance: секция в docs/DESIGN.md с описанием каждого компонента.","status":"closed","priority":0,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:58:06.774112+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:11:38.118668+03:00","closed_at":"2026-02-25T22:11:38.118668+03:00","close_reason":"Спецификация создана в docs/DESIGN.md (2047 строк)","dependencies":[{"issue_id":"benefit-market-09b.2","depends_on_id":"benefit-market-09b","type":"parent-child","created_at":"2026-02-25T21:58:06.775152+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-09b.3","title":"Дизайн-спецификация: layouts и wireframes ключевых экранов","description":"ASCII/текстовые wireframes для ключевых экранов:\n\nEMPLOYEE:\n1. Каталог льгот — grid 3 колонки (desktop), 1 колонка (mobile), поиск + фильтр сверху.\n2. Детальная страница льготы — hero + описание + sidebar с ценой и кнопкой.\n3. Корзина — список позиций + итого + кнопка оформления.\n4. Кошелёк — баланс card вверху + таблица транзакций.\n5. История заказов — таблица/список с фильтром.\n\nHR:\n6. Дашборд — 4 метрики вверху + 3 графика (bar, pie, line).\n7. Список сотрудников — таблица с поиском.\n8. Импорт CSV — зона загрузки + превью + результат.\n\nADMIN:\n9. CRUD таблица (универсальный паттерн) — header + фильтры + таблица + pagination.\n10. Форма создания/редактирования — модальное окно или drawer.\n\nДля каждого: описание layout, responsive поведение (desktop → tablet → mobile).\nSidebar: 256px desktop, overlay на mobile, иконки + labels.\n\nAcceptance: секция в docs/DESIGN.md с wireframes.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:58:13.071675+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:11:38.202707+03:00","closed_at":"2026-02-25T22:11:38.202707+03:00","close_reason":"Спецификация создана в docs/DESIGN.md (2047 строк)","dependencies":[{"issue_id":"benefit-market-09b.3","depends_on_id":"benefit-market-09b","type":"parent-child","created_at":"2026-02-25T21:58:13.072425+03:00","created_by":"ayugunin"},{"issue_id":"benefit-market-09b.3","depends_on_id":"benefit-market-09b.1","type":"blocks","created_at":"2026-02-25T22:04:58.395291+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-09b.4","title":"Настройка Tailwind + shadcn/ui theme","description":"Реализовать дизайн-систему в коде:\n\n1. tailwind.config.ts:\n   - Расширить colors с кастомной палитрой.\n   - Добавить fontFamily (Google Fonts).\n   - Настроить borderRadius, spacing если нужно.\n\n2. globals.css:\n   - CSS переменные для light/dark theme.\n   - @import Google Fonts.\n   - Базовые стили body, headings.\n\n3. shadcn/ui theme:\n   - components.json — настройка стиля (default или new-york).\n   - Кастомизация через CSS переменные (--primary, --secondary, --accent, etc).\n\n4. Добавить компоненты shadcn/ui которые понадобятся:\n   Card, Button, Input, Select, Table, Badge, Dialog, Sheet, Tabs, Skeleton, Toast, DropdownMenu, Avatar, Tooltip.\n\nAcceptance: запускается npm run dev, тема применяется корректно, dark mode переключается.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:58:14.727558+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:49.180568+03:00","closed_at":"2026-02-25T22:19:49.180568+03:00","close_reason":"Tailwind + shadcn/ui + дизайн-система настроены, 26 компонентов установлены","dependencies":[{"issue_id":"benefit-market-09b.4","depends_on_id":"benefit-market-09b","type":"parent-child","created_at":"2026-02-25T21:58:14.728262+03:00","created_by":"ayugunin"},{"issue_id":"benefit-market-09b.4","depends_on_id":"benefit-market-09b.1","type":"blocks","created_at":"2026-02-25T22:04:58.622887+03:00","created_by":"ayugunin"},{"issue_id":"benefit-market-09b.4","depends_on_id":"benefit-market-09b.2","type":"blocks","created_at":"2026-02-25T22:04:58.866914+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-0cf","title":"4.2 Create admin categories page","description":"## 4.2 Create admin categories page\n\n### Файл\n`src/app/dashboard/admin/categories/page.tsx` (CREATE)\n\n### Что сделать\nCRUD страница по паттерну admin/benefits (файл admin/benefits/page.tsx):\n1. Таблица: Название, Иконка, Порядок сортировки\n2. Кнопка 'Добавить категорию' → Dialog с формой (name, icon, sort_order)\n3. Кнопка редактирования в каждой строке → тот же Dialog\n4. Кнопка удаления в каждой строке (с подтверждением)\n5. Loading state, empty state\n6. Fetch /api/admin/categories, POST/PATCH/DELETE\n\n### Компоненты (по паттерну admin/benefits)\nTable, Dialog, Button, Input, Label, Loader2, Pencil, Plus, Trash2, toast\n\n### Верификация\n- Создание категории через диалог\n- Редактирование существующей\n- Удаление с подтверждением\n- Обновление таблицы после CRUD операций","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:28.906781+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:57:34.156695+03:00"}
{"id":"benefit-market-0ea","title":"Epic 12: Security","description":"## Epic 12: Security\n\n### Задачи (параллельно с Epic 9-10)\n1. **Input sanitization** — `src/lib/api/sanitize.ts`: escapeIlike() для SQL ilike queries\n2. **Rate limiting** — `src/lib/api/rate-limiter.ts` + middleware: in-memory rate limiter\n3. **Security headers** — next.config.ts: CSP, X-Frame-Options, X-Content-Type-Options и пр.\n4. **Demo credentials isolation** — dynamic import demo credentials, не включать в production bundle\n\n### Верификация\n- ilike injection не работает\n- Rate limit возвращает 429\n- Security headers в response\n- Demo credentials не в production bundle","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-25T23:54:53.290026+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:59:08.383559+03:00","dependencies":[{"issue_id":"benefit-market-0ea","depends_on_id":"benefit-market-1is","type":"blocks","created_at":"2026-02-25T23:59:27.504596+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0","title":"Админ-панель и полировка","description":"Недели 7-8. Управление tenant'ами, каталогом, политиками и правилами. Аудит-лог, сгорание баллов (expiration cron), UI-полировка, адаптивность.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-25T21:50:55.004791+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.793112+03:00","closed_at":"2026-02-25T22:46:12.793112+03:00","close_reason":"Epic 4 полностью готов","dependencies":[{"issue_id":"benefit-market-1a0","depends_on_id":"benefit-market-94r","type":"blocks","created_at":"2026-02-25T21:55:13.317979+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.1","title":"API + UI: Управление tenant'ами","description":"Страница /dashboard/admin/tenants:\n\nAPI:\n- GET /api/admin/tenants — список tenant'ов с пагинацией.\n- POST /api/admin/tenants — создание нового tenant'а.\n- PATCH /api/admin/tenants/:id — обновление настроек.\n\nUI:\n- Таблица tenant'ов: название, домен, количество сотрудников, дата создания.\n- Модальное окно создания: name, domain, settings.\n- Редактирование в drawer/modal.\n- Доступ: только admin.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:54:19.377647+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.138952+03:00","closed_at":"2026-02-25T22:46:12.138952+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.1","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:19.378363+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.2","title":"API + UI: CRUD каталога льгот (админ)","description":"Страница /dashboard/admin/benefits:\n\nAPI:\n- GET /api/admin/benefits — все льготы (включая неактивные).\n- POST /api/admin/benefits — создание.\n- PATCH /api/admin/benefits/:id — обновление (название, цена, лимит, is_active).\n- DELETE /api/admin/benefits/:id — soft delete (is_active=false).\n- CRUD для benefit_categories.\n\nUI:\n- Таблица: название, категория, цена баллов, лимит, статус (вкл/выкл).\n- Toggle для is_active прямо в таблице.\n- Форма создания/редактирования: все поля + выбор категории.\n- Фильтр по категории и статусу.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:54:22.060993+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.198802+03:00","closed_at":"2026-02-25T22:46:12.198802+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.2","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:22.061618+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.3","title":"API + UI: CRUD budget policies","description":"Страница /dashboard/admin/policies:\n\nAPI:\n- GET /api/admin/policies — все политики tenant'а.\n- POST /api/admin/policies — создание.\n- PATCH /api/admin/policies/:id — обновление.\n- DELETE /api/admin/policies/:id — деактивация.\n\nUI:\n- Таблица: название, баллов, период, фильтр целевой группы, статус.\n- Форма: name, points_amount (числовой input), period (select: monthly/quarterly/yearly), target_filter (визуальный конструктор условий: grade, location, legal_entity — multi-select для каждого), is_active.\n- Предпросмотр: 'Попадает N сотрудников из M'.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:54:24.489911+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.262635+03:00","closed_at":"2026-02-25T22:46:12.262635+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.3","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:24.490552+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.4","title":"API + UI: CRUD eligibility rules","description":"Страница /dashboard/admin/rules (или inline в карточке льготы):\n\nAPI:\n- GET /api/admin/rules?benefit_id= — правила для льготы.\n- POST /api/admin/rules — создание.\n- PATCH /api/admin/rules/:id — обновление.\n- DELETE /api/admin/rules/:id — удаление.\n\nUI:\n- Конструктор условий: grade (multi-select), min_tenure (number), location (multi-select), legal_entity (multi-select).\n- Привязка к конкретной льготе (benefit_id).\n- Предпросмотр: 'Льгота доступна N из M сотрудников'.\n- Можно встроить прямо в форму редактирования льготы.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:27.067449+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.32834+03:00","closed_at":"2026-02-25T22:46:12.32834+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.4","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:27.068031+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.5","title":"API + UI: Управление пользователями и ролями","description":"Страница /dashboard/admin/users:\n\nAPI:\n- GET /api/admin/users — пользователи tenant'а с профилями.\n- PATCH /api/admin/users/:id — изменение роли.\n- POST /api/admin/users/invite — пригласить (создать запись + отправить email, или в MVP просто создать).\n\nUI:\n- Таблица: email, имя, роль, tenant, дата регистрации.\n- Быстрое изменение роли через select в строке.\n- Фильтр по роли и tenant'у.\n- Поиск по email/имени.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:31.357871+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.387293+03:00","closed_at":"2026-02-25T22:46:12.387293+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.5","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:31.358471+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.6","title":"API + UI: Аудит-лог","description":"Страница /dashboard/admin/audit:\n\nAPI:\n- GET /api/admin/audit-log — записи с пагинацией, фильтрацией.\n  Query: ?entity_type=, ?action=, ?user_id=, ?from=, ?to=, ?page=\n\nUI:\n- Таблица: дата/время, пользователь, действие, сущность, diff (expandable row).\n- Фильтры: по типу сущности, по действию, по дате.\n- diff показывать в формате 'было → стало' (JSON diff viewer).\n\nЗапись в audit_log — через database trigger или helper в API routes.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:32.479088+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.448488+03:00","closed_at":"2026-02-25T22:46:12.448488+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.6","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:32.479732+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.7","title":"Edge Function: Сгорание баллов (expiration cron)","description":"Supabase Edge Function + cron:\n\nЗапускается раз в день (00:05).\n\nАлгоритм:\n1. SELECT * FROM wallets WHERE expires_at \u003c now() AND balance \u003e 0.\n2. Для каждого expired wallet:\n   a. INSERT INTO point_ledger type='expire', amount = -balance.\n   b. UPDATE wallets SET balance = 0, reserved = 0.\n3. Логирование: количество expired кошельков, сумма сгоревших баллов.\n\nТест: создать wallet с expires_at в прошлом, запустить функцию, проверить ledger и balance.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:54:33.849103+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.508423+03:00","closed_at":"2026-02-25T22:46:12.508423+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.7","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:33.849926+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1a0.8","title":"UI-полировка: адаптивность, ошибки, пустые состояния","description":"Финальная полировка UI:\n\n1. Адаптивность: все страницы корректно отображаются на 320px-1920px.\n2. Пустые состояния: иконка + текст + CTA для каждого списка (нет заказов, нет льгот, нет сотрудников).\n3. Обработка ошибок: toast-уведомления для API-ошибок, Error Boundary для компонентов.\n4. Loading states: skeleton для всех списков и карточек.\n5. 404 страница.\n6. Toast для успешных действий (заказ создан, импорт завершён).\n7. Confirmation dialogs для деструктивных действий.\n\nshadcn/ui: Toast, AlertDialog, Skeleton.","status":"closed","priority":3,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:54:36.584431+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:12.570396+03:00","closed_at":"2026-02-25T22:46:12.570396+03:00","close_reason":"Admin API (12 routes) + UI (6 pages) + pagination + audit log реализованы","dependencies":[{"issue_id":"benefit-market-1a0.8","depends_on_id":"benefit-market-1a0","type":"parent-child","created_at":"2026-02-25T21:54:36.585057+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1d6","title":"Epic 10: Frontend Polish","description":"## Epic 10: Frontend Polish\n\n### Задачи\n1. **Loading skeletons** — CatalogSkeleton, TablePageSkeleton, DetailPageSkeleton (заменить 'Loading...' текст)\n2. **Stock limit validation in cart store** — не позволять добавить больше stock_limit\n3. **Accessibility** — aria-labels, landmark roles, keyboard nav, focus-visible, skip-to-content link\n\n### Зависимости\nЗависит от Epic 9 (React Query hooks для loading states)\n\n### Верификация\n- Skeleton states вместо 'Loading...'\n- stock_limit проверяется при addItem/updateQuantity\n- axe-core audit без critical/serious violations","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-25T23:54:50.068726+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:58:57.734349+03:00","dependencies":[{"issue_id":"benefit-market-1d6","depends_on_id":"benefit-market-93m","type":"blocks","created_at":"2026-02-25T23:59:26.991227+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-1is","title":"Epic 6: Type Safety and Auth Foundation","description":"## Epic 6: Foundation — Type Safety \u0026 Auth\n\n### Контекст\nКодовая база содержит 40x `as unknown as`, 27x `as never`, ~400 строк дублированного auth-бойлерплейта в 22 API routes. Это затрудняет поддержку, увеличивает риск ошибок и делает рефакторинг опасным.\n\n### Задачи\n1. **Env validation** — `src/lib/env.ts` (CREATE): Zod-схемы для server/client env variables. Runtime validation при старте.\n2. **Typed errors** — `src/lib/errors.ts` (CREATE): AppError class + factory functions (unauthorized, forbidden, notFound, validation, dbError).\n3. **API response helpers** — `src/lib/api/response.ts` (CREATE): success(), error(), withErrorHandling() HOF для routes.\n4. **Shared auth middleware** — `src/lib/api/auth.ts` (CREATE): requireAuth() и requireRole() — возвращают appUser или бросают typed error.\n5. **Typed Supabase queries** — `src/lib/supabase/typed-queries.ts` (CREATE): типизированные обёртки для Supabase CRUD без as unknown as.\n6. **Refactor all 22 API routes** — убрать все as unknown as, as never, заменить auth boilerplate на shared middleware.\n\n### Верификация\n- `npx tsc --noEmit` — 0 ошибок\n- `grep -r 'as unknown as' src/` = 0 результатов\n- `grep -r 'as never' src/` = 0 результатов\n- Все API routes работают как прежде\n- Каждый route \u003c 80 строк","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-25T23:54:43.607075+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:58:31.529084+03:00"}
{"id":"benefit-market-1z2","title":"Epic 7: Business Logic and Demo Isolation","description":"## Epic 7: Foundation — Business Logic \u0026 Demo Isolation\n\n### Контекст\nДублированная логика условий в eligibility.ts и budget.ts. Demo mode чеки (NEXT_PUBLIC_DEMO_MODE) разбросаны по 14 файлам с копипастой. Нет структурированного логирования.\n\n### Задачи\n1. **Shared condition evaluator** — `src/lib/domain/condition-evaluator.ts` (CREATE): извлечь общую логику из eligibility.ts и budget.ts.\n2. **Demo mode centralization**:\n   - `src/lib/api/demo-handler.ts` (CREATE): withDemoFallback() HOF\n   - `src/lib/demo/demo-service.ts` (CREATE): централизованный доступ к demo-данным по entity type\n   - Рефакторинг 14 файлов с demo-чеками\n3. **Structured logger** — `src/lib/logger.ts` (CREATE): JSON-based logger с уровнями, context, timestamp.\n\n### Верификация\n- Demo mode работает во всех routes\n- `grep 'NEXT_PUBLIC_DEMO_MODE' src/app/api/` = 0 (вся логика в demo-handler)\n- Eligibility и budget используют shared evaluator\n- Логгер используется вместо console.error","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-25T23:54:45.205403+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:58:39.00036+03:00"}
{"id":"benefit-market-4op","title":"4.3 Add Categories to admin sidebar","description":"## 4.3 Add Categories to admin sidebar\n\n### Файл\n`src/components/layout/app-sidebar.tsx`\n\n### Текущее состояние\nadminNavItems содержит: Компании, Каталог, Политики, Правила, Пользователи, Аудит. Нет пункта 'Категории'.\n\n### Что сделать\nДобавить в массив adminNavItems:\n```typescript\n{ title: 'Категории', href: '/dashboard/admin/categories', icon: FolderOpen }\n```\nИмпортировать FolderOpen из lucide-react. Расположить после 'Каталог' (Package).\n\n### Верификация\n- Пункт 'Категории' виден в admin sidebar\n- Клик → переход на /dashboard/admin/categories\n- Active state работает","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:30.603185+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:57:40.039181+03:00"}
{"id":"benefit-market-6e7","title":"Epic 8: Service Layer and Atomic Transactions","description":"## Epic 8: Service Layer \u0026 Atomic Transactions\n\n### Контекст\nБизнес-логика размазана по route handlers (создание заказа = 3 отдельных DB запроса без транзакции). Нет service layer. Routes раздутые (100-200 строк).\n\n### Задачи\n1. **Order service + atomic SQL** — `src/lib/services/order.service.ts` + `supabase/migrations/003_create_order_atomic.sql`: атомарная функция create_order_and_reserve().\n2. **Other services** — benefit.service.ts, wallet.service.ts, employee.service.ts, tenant.service.ts, audit.service.ts\n3. **Request validators** — `src/lib/api/validators.ts`: Zod-схемы для всех API inputs.\n4. **Thin route handlers** — рефакторинг всех 22 routes до 30-50 строк (auth middleware + validator + service call + response helper).\n5. **Admin client singleton** — `src/lib/supabase/admin.ts`: lazy singleton для admin client.\n\n### Зависимости\nЗависит от Epic 6 (auth middleware, response helpers, typed queries)\n\n### Верификация\n- Все routes \u003c 50 LOC\n- Build passes\n- Order creation атомарна (rollback при ошибке)\n- Все flow работают end-to-end","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-25T23:54:46.782285+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:58:45.694161+03:00","dependencies":[{"issue_id":"benefit-market-6e7","depends_on_id":"benefit-market-1is","type":"blocks","created_at":"2026-02-25T23:59:26.166427+03:00","created_by":"ayugunin"},{"issue_id":"benefit-market-6e7","depends_on_id":"benefit-market-1z2","type":"blocks","created_at":"2026-02-25T23:59:26.431314+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-72y","title":"Epic 3: HR Policies Page","description":"## Epic 3: HR Policies Page\n\n### Контекст\nHR-менеджеры не могут просматривать бюджетные политики — страница /dashboard/hr/policies это стаб (7 строк, только заголовок). API /api/admin/policies разрешает доступ только admin, HR получает 403.\n\n### Задачи\n- 3.1 Allow HR role in policies API GET (benefit-market-of5)\n- 3.2 Implement HR policies page (benefit-market-rbk)\n\n### Верификация\n- HR видит таблицу политик с пагинацией\n- Нет кнопок создания/редактирования (read-only)\n- Пагинация работает\n- Loading и empty states отображаются","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-25T23:54:21.121383+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:56:56.077175+03:00"}
{"id":"benefit-market-73a","title":"Фундамент: проект, схема БД, авторизация","description":"Недели 1-2. Инициализация проекта Next.js + Supabase, SQL-схема всех таблиц с RLS-политиками, аутентификация, каркас трёх кабинетов (employee/hr/admin), seed-данные.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-25T21:50:48.960381+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:23:34.909361+03:00","closed_at":"2026-02-25T22:23:34.909361+03:00","close_reason":"Фундамент полностью готов: проект, схема, auth, middleware, layouts, RLS, seed","dependencies":[{"issue_id":"benefit-market-73a","depends_on_id":"benefit-market-09b","type":"blocks","created_at":"2026-02-25T21:55:14.864257+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.1","title":"Инициализация Next.js 14 + TypeScript + Tailwind + shadcn/ui","description":"Создать проект Next.js 14 (App Router) с TypeScript strict mode. Установить Tailwind CSS, shadcn/ui. Настроить структуру папок:\n- app/(employee)/ — кабинет сотрудника\n- app/(hr)/ — кабинет HR\n- app/(admin)/ — кабинет админа\n- app/api/ — API routes\n- lib/ — утилиты, supabase client, types\n- components/ — переиспользуемые компоненты\n\nНастроить ESLint, Prettier. Добавить .env.local.example.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:52:15.645368+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.028374+03:00","closed_at":"2026-02-25T22:19:52.028374+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.1","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:15.646749+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.10","title":"Layout трёх кабинетов с навигацией","description":"Создать layout для каждого кабинета:\n\nEmployee layout:\n- Sidebar/header: Каталог, Мои заказы, Кошелёк, Профиль\n- Отображение баланса баллов в header\n\nHR layout:\n- Sidebar: Дашборд, Сотрудники, Импорт, Политики\n- Название компании в header\n\nAdmin layout:\n- Sidebar: Tenant'ы, Каталог, Политики, Правила, Пользователи, Аудит-лог\n- Индикатор выбранного tenant'а\n\nОбщее: тёмная/светлая тема, адаптивный sidebar (collapse на мобильных), breadcrumbs.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:52:45.931747+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.531313+03:00","closed_at":"2026-02-25T22:19:52.531313+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.10","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:45.932602+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.11","title":"Seed-данные: тестовый tenant, пользователи, льготы","description":"Создать seed-скрипт (supabase/seed.sql или scripts/seed.ts):\n\n1 tenant: ООО 'Тестовая компания'\n3 пользователя: employee@test.com, hr@test.com, admin@test.com\n5 employee_profiles с разными грейдами/локациями\n3 benefit_categories: Здоровье, Обучение, Спорт\n10 benefits с разными ценами и лимитами\n3 eligibility_rules\n2 budget_policies\nКошельки с начальным балансом для каждого сотрудника\n\nСкрипт должен быть идемпотентным (можно запускать повторно).","status":"closed","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:48.435778+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:23:34.693626+03:00","closed_at":"2026-02-25T22:23:34.693626+03:00","close_reason":"RLS-политики и seed-данные созданы","dependencies":[{"issue_id":"benefit-market-73a.11","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:48.43638+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.2","title":"Подключение Supabase (Auth + DB + Storage)","description":"Создать проект в Supabase. Настроить клиенты:\n- lib/supabase/client.ts — браузерный клиент\n- lib/supabase/server.ts — серверный клиент (cookies)\n- lib/supabase/admin.ts — service role клиент (для Edge Functions)\n\nНастроить Supabase Auth: email + пароль. Проверить flow регистрации и входа.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:18.941661+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.088394+03:00","closed_at":"2026-02-25T22:19:52.088394+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.2","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:18.942319+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.3","title":"SQL-схема: tenants, users, employee_profiles","description":"Создать миграцию Supabase с таблицами:\n\nCREATE TABLE tenants (id uuid PK, name text NOT NULL, domain text, settings jsonb DEFAULT '{}', created_at timestamptz DEFAULT now());\n\nCREATE TABLE users (id uuid PK, tenant_id uuid FK REFERENCES tenants, auth_id uuid FK REFERENCES auth.users, email text NOT NULL, role text CHECK (role IN ('employee','hr','admin')), created_at timestamptz DEFAULT now());\n\nCREATE TABLE employee_profiles (id uuid PK, user_id uuid FK REFERENCES users, tenant_id uuid FK REFERENCES tenants, grade text, tenure_months int, location text, legal_entity text, extra jsonb DEFAULT '{}');\n\nИндексы на tenant_id для каждой таблицы. UNIQUE(auth_id) на users.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":60,"created_at":"2026-02-25T21:52:23.881811+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.148421+03:00","closed_at":"2026-02-25T22:19:52.148421+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.3","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:23.8825+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.4","title":"SQL-схема: benefits, benefit_categories, eligibility_rules","description":"Создать миграцию с таблицами каталога:\n\nbenefit_categories (id, tenant_id FK, name, icon, sort_order)\nbenefits (id, tenant_id FK, category_id FK, name, description, price_points int, stock_limit int nullable, is_active boolean DEFAULT true, created_at)\neligibility_rules (id, benefit_id FK, tenant_id FK, conditions jsonb)\n\nconditions — JSONB с фильтрами: {grade: ['senior','middle'], min_tenure: 6, location: ['Moscow']}\nИндексы: benefits(tenant_id, is_active), eligibility_rules(benefit_id).","status":"closed","priority":1,"issue_type":"task","estimated_minutes":60,"created_at":"2026-02-25T21:52:28.387747+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.211787+03:00","closed_at":"2026-02-25T22:19:52.211787+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.4","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:28.388386+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.5","title":"SQL-схема: wallets, point_ledger, budget_policies","description":"Создать миграцию с таблицами кошельков:\n\nwallets (id, user_id FK, tenant_id FK, balance int DEFAULT 0, reserved int DEFAULT 0, period text e.g. '2025-Q1', expires_at timestamptz)\nCHECK (balance \u003e= 0), CHECK (reserved \u003e= 0)\nUNIQUE(user_id, period)\n\npoint_ledger (id, wallet_id FK, tenant_id FK, order_id FK nullable, type text CHECK IN ('accrual','reserve','spend','release','expire'), amount int NOT NULL, description text, created_at DEFAULT now())\nAppend-only: никаких UPDATE/DELETE.\n\nbudget_policies (id, tenant_id FK, name, points_amount int, period text CHECK IN ('monthly','quarterly','yearly'), target_filter jsonb, is_active boolean DEFAULT true)","status":"closed","priority":1,"issue_type":"task","estimated_minutes":60,"created_at":"2026-02-25T21:52:33.310512+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.282134+03:00","closed_at":"2026-02-25T22:19:52.282134+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.5","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:33.311115+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.6","title":"SQL-схема: orders, order_items, audit_log","description":"Создать миграцию:\n\norders (id, user_id FK, tenant_id FK, status text CHECK IN ('pending','reserved','paid','cancelled','expired'), total_points int, reserved_at timestamptz, expires_at timestamptz, created_at DEFAULT now())\n\norder_items (id, order_id FK, benefit_id FK, quantity int DEFAULT 1, price_points int)\n\naudit_log (id, tenant_id FK, user_id FK, action text, entity_type text, entity_id uuid, diff jsonb, created_at DEFAULT now())\n\nИндексы: orders(user_id, status), orders(tenant_id, status), orders(status, expires_at) для TTL cron.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":60,"created_at":"2026-02-25T21:52:36.219869+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.345194+03:00","closed_at":"2026-02-25T22:19:52.345194+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.6","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:36.220444+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.7","title":"RLS-политики для всех таблиц","description":"Включить RLS на всех таблицах. Создать политики:\n\ntenants: admin видит все, остальные — только свой tenant.\nusers: admin — все, hr — свой tenant, employee — только себя.\nemployee_profiles: hr/admin — свой tenant, employee — только себя.\nbenefits: все роли — свой tenant + is_active (employee), admin — все.\nbenefit_categories: все роли — свой tenant.\neligibility_rules: admin — свой tenant.\nbudget_policies: hr/admin — свой tenant.\nwallets: employee — только свои, hr/admin — свой tenant.\npoint_ledger: INSERT только через service_role. SELECT: employee — свои, hr/admin — свой tenant.\norders: employee — свои, hr/admin — свой tenant.\norder_items: через join с orders.\naudit_log: admin — свой tenant.\n\nJWT содержит tenant_id и role в app_metadata.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:52:39.804753+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:23:34.633422+03:00","closed_at":"2026-02-25T22:23:34.633422+03:00","close_reason":"RLS-политики и seed-данные созданы","dependencies":[{"issue_id":"benefit-market-73a.7","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:39.805382+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.8","title":"Supabase Auth: JWT custom claims (role, tenant_id)","description":"Настроить Supabase Auth hook или database function для добавления custom claims в JWT:\n- tenant_id — из таблицы users\n- role — из таблицы users\n\nСоздать функцию:\nCREATE OR REPLACE FUNCTION auth.custom_access_token_hook(event jsonb) RETURNS jsonb\nКоторая добавляет в token claims из таблицы users по auth.uid().\n\nЭто критично — без claims RLS-политики не работают.\nТестировать: зарегистрировать пользователя, проверить JWT в jwt.io.","status":"closed","priority":0,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:52:41.894556+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.407873+03:00","closed_at":"2026-02-25T22:19:52.407873+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.8","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:41.895161+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-73a.9","title":"Middleware: route protection по ролям","description":"Создать middleware.ts в корне проекта:\n- Проверять наличие сессии Supabase Auth.\n- Извлекать role из JWT.\n- Маршруты /dashboard/employee/* — только employee.\n- Маршруты /dashboard/hr/* — только hr, admin.\n- Маршруты /dashboard/admin/* — только admin.\n- /auth/* — доступ без аутентификации.\n- Редирект неавторизованных на /auth/login.\n- Редирект при недостаточных правах на страницу своего кабинета.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:43.668667+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:19:52.468205+03:00","closed_at":"2026-02-25T22:19:52.468205+03:00","close_reason":"Реализовано: Next.js 14 + Supabase + SQL schema + Auth + Middleware + Layouts","dependencies":[{"issue_id":"benefit-market-73a.9","depends_on_id":"benefit-market-73a","type":"parent-child","created_at":"2026-02-25T21:52:43.669236+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-7l7","title":"5.6 HR dashboard CSV export","description":"## 5.6 HR dashboard CSV export\n\n### Файл\n`src/app/dashboard/hr/page.tsx`\n\n### Текущее состояние\nHR дашборд показывает метрики и графики, но нет возможности экспортировать данные.\n\n### Что сделать\n1. Добавить кнопку 'Экспорт в CSV' в header (рядом с заголовком)\n2. При клике:\n   - Использовать papaparse (уже в зависимостях) для генерации CSV\n   - Данные: popular_benefits + category_distribution + summary\n   - Создать Blob и скачать через URL.createObjectURL + a.click()\n3. Кнопка disabled пока data не загружена\n\n```typescript\nimport Papa from 'papaparse';\nimport { Download } from 'lucide-react';\n\nfunction handleExportCsv() {\n  if (!data) return;\n  const rows = data.popular_benefits.map(b =\u003e ({\n    'Льгота': b.name,\n    'Заказов': b.order_count,\n    'Баллов': b.total_points,\n  }));\n  const csv = Papa.unparse(rows);\n  const blob = new Blob(['\\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = 'hr-dashboard-export.csv';\n  a.click();\n  URL.revokeObjectURL(url);\n}\n```\n\n### Верификация\n- Кнопка появляется после загрузки данных\n- CSV файл скачивается с корректными данными\n- BOM (\\ufeff) обеспечивает корректное отображение кириллицы в Excel","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:41.987635+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:58:26.182228+03:00"}
{"id":"benefit-market-83x","title":"Epic 13: DevOps","description":"## Epic 13: DevOps\n\n### Задачи\n1. **Pre-commit hooks** — husky + lint-staged (eslint, prettier, tsc --noEmit)\n2. **CI/CD** — .github/workflows/ci.yml: lint, typecheck, test, build, playwright\n3. **Docker** — Dockerfile + docker-compose.yml для local development\n4. **ESLint strengthening** — strict rules, no-any, no-explicit-any\n\n### Верификация\n- Pre-commit hooks блокируют плохой код\n- CI pipeline зелёный\n- docker-compose up запускает приложение","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-25T23:54:54.882381+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:59:14.219197+03:00","dependencies":[{"issue_id":"benefit-market-83x","depends_on_id":"benefit-market-9hx","type":"blocks","created_at":"2026-02-25T23:59:27.789209+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-8wa","title":"4.1 Add PATCH/DELETE to categories API","description":"## 4.1 Add PATCH/DELETE to categories API\n\n### Файл\n`src/app/api/admin/categories/route.ts`\n\n### Текущее состояние\nТолько GET и POST handlers. Нет возможности обновлять или удалять категории.\n\n### Что сделать\n1. Добавить PATCH handler:\n   - Валидация: z.object({ id: z.string().uuid(), name, icon, sort_order — все optional })\n   - Auth + role check (admin only)\n   - admin.from('benefit_categories').update({...}).eq('id', id).eq('tenant_id', appUser.tenant_id).select().single()\n2. Добавить DELETE handler:\n   - Params: id из body или searchParams\n   - Auth + role check (admin only)\n   - Проверить что нет benefits привязанных к категории (или каскадный delete)\n   - admin.from('benefit_categories').delete().eq('id', id).eq('tenant_id', appUser.tenant_id)\n\n### Верификация\n- PATCH обновляет name, icon, sort_order\n- DELETE удаляет категорию\n- 401 без авторизации, 403 для не-admin\n- Валидация работает","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:27.395467+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:57:25.515598+03:00"}
{"id":"benefit-market-93m","title":"Epic 9: React Query Data Layer","description":"## Epic 9: React Query Data Layer\n\n### Контекст\nВсе 13+ страниц используют useEffect + fetch + useState для загрузки данных. Нет кэширования, нет автоматической инвалидации, много boilerplate.\n\n### Задачи\n1. Install + configure React Query (@tanstack/react-query), добавить QueryProvider в layout\n2. Typed API client — `src/lib/api/client.ts`: обёртка над fetch с типизацией\n3. Query hooks: use-benefits, use-orders, use-wallet, use-employees, use-dashboard, use-categories\n4. Mutation hooks: use-create-order, use-cancel-order, use-confirm-order (с invalidation)\n5. Migrate all 13+ pages с useEffect+fetch на hooks\n\n### Зависимости\nЗависит от Epic 8 (service layer, standardized API responses)\n\n### Верификация\n- Кэширование работает (повторный заход на страницу — мгновенно)\n- Мутации автоматически инвалидируют queries\n- Нет useEffect+fetch в pages\n- Loading/error states через React Query","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-25T23:54:48.440931+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:58:51.939772+03:00","dependencies":[{"issue_id":"benefit-market-93m","depends_on_id":"benefit-market-6e7","type":"blocks","created_at":"2026-02-25T23:59:26.693499+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r","title":"Заказы, HR-кабинет и импорт","description":"Недели 5-6. Корзина, оформление заказов с резервом баллов, подтверждение/отмена, TTL резервов, CSV-импорт сотрудников, HR-дашборд с графиками на recharts.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-25T21:50:52.04065+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.973016+03:00","closed_at":"2026-02-25T22:39:17.973016+03:00","close_reason":"Epic 3 полностью готов","dependencies":[{"issue_id":"benefit-market-94r","depends_on_id":"benefit-market-ivk","type":"blocks","created_at":"2026-02-25T21:55:13.095569+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.1","title":"API: POST /api/orders — создание заказа с резервом баллов","description":"Next.js API route POST /api/orders:\n\nBody: { items: [{ benefit_id, quantity }] }\nДоступ: employee.\n\nАлгоритм:\n1. Валидация Zod: items не пуст, quantity \u003e 0.\n2. Проверить eligibility для каждой льготы.\n3. Проверить stock_limit (если есть).\n4. Рассчитать total_points = SUM(price_points * quantity).\n5. Проверить wallet.balance - wallet.reserved \u003e= total_points.\n6. В транзакции:\n   a. Создать order (status=reserved, reserved_at=now(), expires_at=now()+15min).\n   b. Создать order_items.\n   c. Создать point_ledger записи type=reserve.\n   d. Увеличить wallet.reserved на total_points.\n7. Вернуть order с items.\n\nОшибки: insufficient_points, benefit_not_available, stock_exceeded.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:53:29.847499+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.160027+03:00","closed_at":"2026-02-25T22:39:17.160027+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.1","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:29.848085+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.10","title":"UI: HR-дашборд на recharts","description":"Страница /dashboard/hr:\n\nКарточки-метрики вверху:\n- Общий бюджет / Потрачено / Утилизация %\n- Всего сотрудников / Активных\n\nГрафики (recharts):\n- BarChart: топ-5 популярных льгот.\n- PieChart: распределение по категориям.\n- LineChart/AreaChart: динамика начислений/списаний по месяцам.\n\nResponsive: на мобильных графики в 1 колонку.\nSkeleton loading для каждого блока.\n\nКомпоненты: MetricCard, BenefitPopularityChart, CategoryPieChart, TrendChart.\nshadcn/ui Card + recharts.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2026-02-25T21:53:53.061968+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.749176+03:00","closed_at":"2026-02-25T22:39:17.749176+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.10","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:53.062647+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.2","title":"API: POST /api/orders/:id/confirm — подтверждение заказа","description":"Next.js API route POST /api/orders/:id/confirm:\n\nДоступ: employee (только свои заказы).\n\nАлгоритм:\n1. Найти order по id, проверить принадлежность user_id.\n2. Проверить status = 'reserved'.\n3. Проверить expires_at \u003e now() (не истёк).\n4. В транзакции:\n   a. order.status = 'paid'.\n   b. Создать point_ledger type=spend (отрицательная запись).\n   c. Уменьшить wallet.balance на total_points.\n   d. Уменьшить wallet.reserved на total_points.\n   e. Если есть stock_limit — уменьшить stock.\n5. Записать в audit_log.\n\nОшибки: order_not_found, order_expired, invalid_status.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:53:32.482789+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.226926+03:00","closed_at":"2026-02-25T22:39:17.226926+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.2","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:32.483396+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.3","title":"API: POST /api/orders/:id/cancel — отмена заказа","description":"Next.js API route POST /api/orders/:id/cancel:\n\nДоступ: employee (только свои заказы).\n\nАлгоритм:\n1. Найти order по id, проверить user_id.\n2. Проверить status = 'reserved' (paid нельзя отменить в MVP).\n3. В транзакции:\n   a. order.status = 'cancelled'.\n   b. Создать point_ledger type=release.\n   c. Уменьшить wallet.reserved на total_points.\n4. Записать в audit_log.\n\nОшибки: order_not_found, cannot_cancel_paid.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:53:34.667668+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.293055+03:00","closed_at":"2026-02-25T22:39:17.293055+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.3","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:34.668249+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.4","title":"UI: Корзина и оформление заказа","description":"Реализовать flow покупки:\n\n1. Корзина (client-side state, zustand или context):\n   - Добавление/удаление льгот.\n   - Изменение количества.\n   - Отображение суммы в баллах.\n   - Сравнение с доступным балансом.\n   - Persist в localStorage.\n\n2. Страница /dashboard/employee/cart:\n   - Список позиций с ценами.\n   - Итого баллов.\n   - Предупреждение если баллов не хватает.\n   - Кнопка 'Оформить заказ' → POST /api/orders.\n   - После создания → переход на страницу заказа.\n\n3. Страница /dashboard/employee/orders/:id:\n   - Статус заказа (reserved/paid/cancelled/expired).\n   - Таймер TTL (осталось X минут на подтверждение).\n   - Кнопки: 'Подтвердить', 'Отменить' (если reserved).\n\nshadcn/ui: Card, Button, Badge, Alert.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":240,"created_at":"2026-02-25T21:53:37.962804+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.353434+03:00","closed_at":"2026-02-25T22:39:17.353434+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.4","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:37.963405+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.5","title":"UI: История заказов сотрудника","description":"Страница /dashboard/employee/orders:\n\n- Список заказов: дата, статус, сумма баллов, количество позиций.\n- Фильтр по статусу (все / активные / завершённые).\n- Сортировка по дате (новые первые).\n- Клик → детали заказа.\n- Статус-бейджи с цветовым кодированием:\n  reserved — жёлтый, paid — зелёный, cancelled — серый, expired — красный.\n\nAPI: GET /api/orders (с пагинацией, фильтром по статусу).","status":"closed","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:53:40.07787+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.416481+03:00","closed_at":"2026-02-25T22:39:17.416481+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.5","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:40.078495+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.6","title":"Edge Function: TTL резервов (cron)","description":"Supabase Edge Function + pg_cron:\n\nЗапускается каждые 5 минут.\n\nАлгоритм:\n1. SELECT * FROM orders WHERE status = 'reserved' AND expires_at \u003c now().\n2. Для каждого expired order:\n   a. UPDATE orders SET status = 'expired'.\n   b. INSERT INTO point_ledger type = 'release'.\n   c. UPDATE wallets SET reserved = reserved - order.total_points.\n3. Логирование: сколько заказов expired.\n\nАльтернатива pg_cron: Supabase Edge Function вызываемая через cron.supabase.com или Vercel cron.\n\nТест: создать заказ, подождать TTL, проверить что баллы вернулись.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:53:42.471808+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.477426+03:00","closed_at":"2026-02-25T22:39:17.477426+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.6","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:42.472511+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.7","title":"API: POST /api/import/employees — CSV-импорт","description":"Next.js API route POST /api/import/employees:\n\nДоступ: hr.\nContent-Type: multipart/form-data (файл CSV).\n\nФормат CSV:\nemail,name,grade,tenure_months,location,legal_entity\n\nАлгоритм:\n1. Парсинг CSV (papaparse).\n2. Валидация каждой строки через Zod.\n3. Для каждой валидной строки:\n   a. Upsert в users по email + tenant_id (создать если нет).\n   b. Upsert в employee_profiles.\n   c. Если новый сотрудник — создать wallet с balance = 0.\n4. Вернуть отчёт: { created: N, updated: N, errors: [{row: N, error: '...'}] }.\n\nЛимит: 1000 строк за раз. Обработка дубликатов email.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:53:45.2027+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.539969+03:00","closed_at":"2026-02-25T22:39:17.539969+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.7","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:45.203365+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.8","title":"UI: Страница импорта сотрудников","description":"Страница /dashboard/hr/import:\n\n1. Drag \u0026 drop зона для CSV файла (или кнопка выбора).\n2. Предпросмотр первых 5 строк перед импортом.\n3. Кнопка 'Импортировать'.\n4. Progress indicator во время загрузки.\n5. Результат: сводка (создано / обновлено / ошибки).\n6. Таблица ошибок: строка, поле, описание ошибки.\n7. Ссылка на скачивание шаблона CSV.\n\nshadcn/ui: Card, Table, Alert, Progress, Button.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:53:47.738115+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.604458+03:00","closed_at":"2026-02-25T22:39:17.604458+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.8","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:47.738839+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-94r.9","title":"API: GET /api/reports/dashboard — данные HR-дашборда","description":"Next.js API route GET /api/reports/dashboard:\n\nДоступ: hr, admin.\n\nВозвращает агрегированные данные для tenant'а:\n1. Утилизация бюджета: total_accrued, total_spent, utilization_pct.\n2. Топ-5 популярных льгот: benefit_name, order_count, total_points.\n3. Активность сотрудников: total_employees, active (\u003e=1 заказ), inactive.\n4. Распределение по категориям: category_name, spent_points, pct.\n5. Динамика по месяцам (последние 6): month, accrued, spent.\n\nВсе запросы через SQL с группировкой. Кэширование не нужно для MVP.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:53:50.212598+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:39:17.685624+03:00","closed_at":"2026-02-25T22:39:17.685624+03:00","close_reason":"Orders API, cart, HR dashboard, CSV import, employee list реализованы","dependencies":[{"issue_id":"benefit-market-94r.9","depends_on_id":"benefit-market-94r","type":"parent-child","created_at":"2026-02-25T21:53:50.216263+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-991","title":"5.1 Create error boundary component","description":"## 5.1 Create error boundary component\n\n### Файл\n`src/components/shared/error-boundary.tsx` (CREATE)\n\n### Что сделать\nReact class component (error boundaries требуют class components):\n```typescript\ninterface Props { children: React.ReactNode; fallback?: React.ReactNode }\ninterface State { hasError: boolean; error: Error | null }\n\nclass ErrorBoundary extends React.Component\u003cProps, State\u003e {\n  state = { hasError: false, error: null };\n  static getDerivedStateFromError(error) { return { hasError: true, error }; }\n  componentDidCatch(error, info) { console.error('ErrorBoundary caught:', error, info); }\n  handleRetry = () =\u003e { this.setState({ hasError: false, error: null }); };\n  render() {\n    if (this.state.hasError) {\n      return this.props.fallback || \u003cDefaultFallback error={this.state.error} onRetry={this.handleRetry} /\u003e;\n    }\n    return this.props.children;\n  }\n}\n```\n\nDefaultFallback UI: Card с иконкой AlertTriangle, заголовок 'Произошла ошибка', описание ошибки (в dev), кнопка 'Попробовать снова'.\n\n### Верификация\n- Компонент экспортируется\n- Ловит ошибки в children\n- Показывает fallback UI\n- Кнопка retry сбрасывает состояние","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:33.900808+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:57:47.368826+03:00"}
{"id":"benefit-market-9hx","title":"Epic 11: Testing","description":"## Epic 11: Testing\n\n### Задачи\n1. **Setup**: vitest, @testing-library/react, MSW, playwright, test factories\n2. **Unit tests**: condition-evaluator, order.service, wallet.service, cart store, errors\n3. **Component tests**: benefit-card, wallet-balance-card\n4. **Integration tests**: benefits API, orders API (с MSW)\n5. **E2E**: catalog flow, cart-checkout, orders, hr-dashboard, admin-crud (Playwright)\n\n### Зависимости\nЗависит от Epic 10 (финальный UI)\n\n### Верификация\n- `npm test` — all green\n- `npx playwright test` — all green\n- Coverage \u003e 60% для lib/","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-25T23:54:51.621828+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:59:03.157316+03:00","dependencies":[{"issue_id":"benefit-market-9hx","depends_on_id":"benefit-market-1d6","type":"blocks","created_at":"2026-02-25T23:59:27.245216+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-9mk","title":"2.1 Make benefit cards clickable","description":"## 2.1 Make benefit cards clickable\n\n### Файл\n`src/components/benefits/benefit-card.tsx`\n\n### Текущее состояние\nBenefitCard — это Card с CardHeader, CardContent, CardFooter. Нет Link/навигации. Единственное взаимодействие — кнопка 'Добавить'.\n\n### Что сделать\n1. Импортировать `Link` из `next/link`\n2. Обернуть CardHeader + CardContent в `\u003cLink href={\\`/dashboard/employee/catalog/${benefit.id}\\`}\u003e`\n3. Кнопку в CardFooter оставить снаружи Link (чтобы клик по кнопке не навигировал)\n4. Добавить cursor-pointer на кликабельную область\n\n### Верификация\n- Клик по названию/описанию → переход на детальную страницу\n- Клик по кнопке 'Добавить' → добавление в корзину (не навигация)\n- Hover state визуально различается","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:19.487671+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:56:50.540914+03:00"}
{"id":"benefit-market-9wj","title":"5.5 Fix category icon mapping (heart-pulse)","description":"## 5.5 Fix category icon mapping (heart-pulse)\n\n### Файлы\n- `src/components/benefits/category-filter.tsx`\n- `src/components/benefits/benefit-card.tsx`\n- `src/app/dashboard/employee/catalog/[id]/page.tsx`\n\n### Текущее состояние\nDemo data использует icon='heart-pulse' для категории 'Здоровье' (demo-cat-001), но iconMap во всех трёх файлах не содержит 'heart-pulse'. Категория рендерится с fallback иконкой Package.\n\n### Что сделать\nВ каждом из трёх файлов:\n1. Импортировать HeartPulse из lucide-react\n2. Добавить в iconMap: `'heart-pulse': HeartPulse`\n\n### Верификация\n- Категория 'Здоровье' отображается с иконкой HeartPulse (пульсирующее сердце)\n- В фильтре категорий, на карточке и на детальной странице","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:40.315829+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:58:14.822043+03:00"}
{"id":"benefit-market-b0e","title":"1.1 Connect add-to-cart in catalog page","description":"## 1.1 Connect add-to-cart in catalog page\n\n### Файл\n`src/app/dashboard/employee/catalog/page.tsx` (lines 64-67)\n\n### Текущее состояние\n`handleAddToCart` содержит только `console.log('Add to cart:', benefit.id)` — ничего реально не добавляется.\n\n### Что сделать\n1. Импортировать `useCartStore` из `@/lib/store/cart`\n2. Импортировать `toast` из `sonner`\n3. Заменить console.log на:\n   - `useCartStore().addItem({ id, name, price_points, category_name, category_icon })`\n   - `toast.success(\\`${benefit.name} добавлен в корзину\\`)`\n\n### Верификация\n- Клик 'Добавить' в каталоге → товар появляется в корзине\n- Повторный клик → quantity увеличивается\n- Toast уведомление отображается","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-25T23:54:12.961758+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:56:26.569267+03:00"}
{"id":"benefit-market-b7k","title":"Epic 2: Catalog Navigation","description":"## Epic 2: Catalog Navigation\n\n### Контекст\nКарточки льгот в каталоге не кликабельны — только кнопка 'Добавить'. Пользователь не может перейти на детальную страницу кликом по карточке.\n\n### Задачи\n- 2.1 Make benefit cards clickable (benefit-market-9mk)\n\n### Верификация\n- Клик по карточке (header + content) → переход на /dashboard/employee/catalog/[id]\n- Клик по кнопке 'Добавить' → добавление в корзину (НЕ навигация)","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-25T23:54:17.799148+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:56:44.460163+03:00"}
{"id":"benefit-market-cmu","title":"1.3 Fix wallet data normalization in cart page","description":"## 1.3 Fix wallet data normalization in cart page\n\n### Файл\n`src/app/dashboard/employee/cart/page.tsx` (line 51)\n\n### Текущее состояние\n`setWallet(json.data)` — но API /wallets/me возвращает разные форматы:\n- **Demo mode**: `{ data: { wallet: { balance, reserved, ... }, ledger: [...] } }`\n- **Real mode**: `{ data: { balance, reserved, available, ... } }`\n\nCart page ожидает `{ balance, reserved, available }`, но в demo получает вложенный объект.\n\n### Что сделать\nНормализовать ответ:\n```typescript\nconst d = json.data;\nif (d.wallet) {\n  // demo mode\n  setWallet({ balance: d.wallet.balance, reserved: d.wallet.reserved, available: d.wallet.balance - d.wallet.reserved });\n} else {\n  // real mode\n  setWallet(d);\n}\n```\n\n### Верификация\n- В demo mode баланс отображается корректно (45000 б., доступно 39000 б.)\n- В real mode баланс отображается корректно\n- Warning 'Недостаточно баллов' работает при превышении","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-25T23:54:16.286106+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:56:39.188891+03:00"}
{"id":"benefit-market-de4","title":"5.4 Demo mode for confirm/cancel orders","description":"## 5.4 Demo mode for confirm/cancel orders\n\n### Файлы\n- `src/app/api/orders/[id]/confirm/route.ts`\n- `src/app/api/orders/[id]/cancel/route.ts`\n\n### Текущее состояние\nОба route обращаются к Supabase для auth и data — в demo mode нет реального auth, поэтому confirm/cancel возвращают 401.\n\n### Что сделать\nДобавить demo mode обработку в начало каждого POST handler (по паттерну других routes):\n\n**confirm/route.ts:**\n```typescript\nif (process.env.NEXT_PUBLIC_DEMO_MODE === 'true') {\n  const { id: orderId } = await params;\n  return NextResponse.json({\n    data: { id: orderId, status: 'paid', total_points: 0, user_id: 'demo-user-001', tenant_id: 'demo-tenant-001', reserved_at: new Date().toISOString(), expires_at: new Date().toISOString(), created_at: new Date().toISOString() }\n  });\n}\n```\n\n**cancel/route.ts:** аналогично, но status: 'cancelled'.\n\n### Верификация\n- В demo mode: confirm → 200 с status 'paid'\n- В demo mode: cancel → 200 с status 'cancelled'\n- В real mode: поведение не изменилось","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:38.819267+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:58:08.561476+03:00"}
{"id":"benefit-market-dvc","title":"Epic 14: Performance","description":"## Epic 14: Performance\n\n### Задачи\n1. **DB indexes** — `supabase/migrations/004_add_indexes.sql`: 10 индексов для частых queries\n2. **Parallel queries** — Promise.all() в dashboard services\n3. **DB-level pagination** — серверная пагинация для benefits API (сейчас клиентская)\n4. **Code splitting** — React.lazy() для chart-компонентов (recharts тяжёлый)\n5. **Feature flags** — `src/lib/feature-flags.ts`: простая система feature flags\n\n### Верификация\n- Dashboard загружается быстрее (параллельные queries)\n- Benefits API поддерживает server-side pagination\n- Chart bundle отложен (lazy load)\n- Feature flags работают","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-25T23:54:56.69474+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:59:19.880508+03:00","dependencies":[{"issue_id":"benefit-market-dvc","depends_on_id":"benefit-market-83x","type":"blocks","created_at":"2026-02-25T23:59:28.081364+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ed5","title":"Epic 1: Cart Integration Fix","description":"## Epic 1: Cart Integration Fix\n\n**Приоритет**: P0 — без этого приложение не функционирует\n\n### Контекст\nКорзина не работает: в каталоге console.log вместо реального addItem, на детальной странице кнопка без onClick, в корзине баланс кошелька не нормализуется между demo и real режимами.\n\n### Задачи\n- 1.1 Connect add-to-cart in catalog page (benefit-market-b0e)\n- 1.2 Connect add-to-cart on detail page (benefit-market-t2x)\n- 1.3 Fix wallet data normalization in cart page (benefit-market-cmu)\n\n### Верификация\n- build passes\n- Добавление в корзину работает с обеих страниц (каталог + детальная)\n- Баланс в корзине корректен в demo и real режимах\n- toast уведомления при добавлении","status":"open","priority":0,"issue_type":"feature","created_at":"2026-02-25T23:54:11.178161+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:56:20.136911+03:00"}
{"id":"benefit-market-gjz","title":"5.2 Wrap dashboard layout with ErrorBoundary","description":"## 5.2 Wrap dashboard layout with ErrorBoundary\n\n### Файл\n`src/app/dashboard/layout.tsx`\n\n### Текущее состояние\nChildren рендерятся напрямую в SidebarInset без error boundary.\n\n### Что сделать\n1. Импортировать ErrorBoundary из '@/components/shared/error-boundary'\n2. Обернуть {children} в \u003cErrorBoundary\u003e:\n```tsx\n\u003cSidebarInset\u003e\n  \u003cErrorBoundary\u003e\n    {children}\n  \u003c/ErrorBoundary\u003e\n\u003c/SidebarInset\u003e\n```\n\nВажно: ErrorBoundary — client component, layout — server component. Нужно убедиться что 'use client' в error-boundary.tsx НЕ нужен (class component работает и так), или использовать dynamic import.\n\n### Верификация\n- Ошибка в любой dashboard странице → fallback UI вместо белого экрана\n- Sidebar остаётся доступным\n- Retry работает","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:35.572708+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:57:53.843736+03:00"}
{"id":"benefit-market-gp6","title":"5.3 Cart badge in sidebar","description":"## 5.3 Cart badge in sidebar\n\n### Файл\n`src/components/layout/app-sidebar.tsx`\n\n### Зависимости\nЗависит от Epic 1 (корзина должна работать)\n\n### Текущее состояние\nПункт 'Корзина' в employee sidebar без индикатора количества товаров.\n\n### Что сделать\n1. Импортировать useCartStore из '@/lib/store/cart'\n2. Получить items из стора\n3. Для пункта 'Корзина' добавить Badge с количеством:\n```tsx\n\u003cSidebarMenuButton asChild isActive={isActive} tooltip={item.title}\u003e\n  \u003cLink href={item.href}\u003e\n    \u003citem.icon /\u003e\n    \u003cspan\u003e{item.title}\u003c/span\u003e\n    {item.href === '/dashboard/employee/cart' \u0026\u0026 cartCount \u003e 0 \u0026\u0026 (\n      \u003cBadge variant='secondary' className='ml-auto size-5 justify-center rounded-full p-0 text-xs'\u003e\n        {cartCount}\n      \u003c/Badge\u003e\n    )}\n  \u003c/Link\u003e\n\u003c/SidebarMenuButton\u003e\n```\n\n### Верификация\n- Badge появляется когда в корзине есть товары\n- Badge обновляется при добавлении/удалении\n- Badge скрывается при пустой корзине\n- Badge не появляется в HR/Admin sidebar","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:37.225203+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:58:01.618772+03:00","dependencies":[{"issue_id":"benefit-market-gp6","depends_on_id":"benefit-market-b0e","type":"blocks","created_at":"2026-02-25T23:55:17.698322+03:00","created_by":"ayugunin"},{"issue_id":"benefit-market-gp6","depends_on_id":"benefit-market-t2x","type":"blocks","created_at":"2026-02-25T23:55:19.316937+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg","title":"Тестирование и деплой","description":"Недели 9-10. E2E тесты (Playwright), базовое нагрузочное тестирование, документация для защиты, деплой демо-стенда.","status":"in_progress","priority":2,"issue_type":"epic","created_at":"2026-02-25T21:50:56.264555+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:46:18.142527+03:00","dependencies":[{"issue_id":"benefit-market-hwg","depends_on_id":"benefit-market-1a0","type":"blocks","created_at":"2026-02-25T21:55:13.523472+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.1","title":"E2E тесты: авторизация и роли","description":"Playwright E2E тесты:\n\n1. Регистрация нового пользователя.\n2. Вход с email + пароль.\n3. Редирект employee на /dashboard/employee.\n4. Редирект HR на /dashboard/hr.\n5. Редирект admin на /dashboard/admin.\n6. Employee не может открыть /dashboard/admin → редирект.\n7. HR не может открыть /dashboard/admin → редирект.\n8. Неавторизованный → /auth/login.\n\nFixtures: тестовые пользователи из seed-данных.\nCI: запуск на GitHub Actions.","status":"open","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:38.806164+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:38.806164+03:00","dependencies":[{"issue_id":"benefit-market-hwg.1","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:38.806836+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.2","title":"E2E тесты: покупка льготы (happy path)","description":"Playwright E2E тесты:\n\n1. Войти как employee.\n2. Открыть каталог, увидеть доступные льготы.\n3. Кликнуть на льготу → детальная страница.\n4. Добавить в корзину.\n5. Перейти в корзину, проверить итого.\n6. Оформить заказ → статус reserved.\n7. Подтвердить заказ → статус paid.\n8. Проверить баланс кошелька уменьшился.\n9. Проверить заказ в истории заказов.\n\nТест отмены:\n10. Создать заказ → cancel → баланс вернулся.","status":"open","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:42.067074+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:42.067074+03:00","dependencies":[{"issue_id":"benefit-market-hwg.2","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:42.067626+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.3","title":"E2E тесты: HR-импорт и дашборд","description":"Playwright E2E тесты:\n\n1. Войти как HR.\n2. Открыть страницу импорта.\n3. Загрузить тестовый CSV (fixtures/test-employees.csv).\n4. Проверить отчёт: N создано, M обновлено.\n5. Перейти в список сотрудников — новые сотрудники появились.\n6. Открыть дашборд — графики отображаются.\n7. Тест ошибок импорта: загрузить невалидный CSV → показать ошибки.","status":"open","priority":3,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:54:44.984435+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:44.984435+03:00","dependencies":[{"issue_id":"benefit-market-hwg.3","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:44.985068+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.4","title":"Нагрузочное тестирование (k6)","description":"Базовое нагрузочное тестирование с k6:\n\nСценарии:\n1. Каталог льгот: 100 VU, 30s — GET /api/benefits.\n2. Создание заказа: 50 VU, 30s — POST /api/orders.\n3. Смешанный: 100 VU (70% каталог, 20% заказы, 10% кошелёк), 60s.\n\nПроверки:\n- p95 \u003c 500ms.\n- Error rate \u003c 1%.\n- Нет deadlock'ов при параллельных заказах.\n\nОтчёт: summary в markdown для дипломной работы.","status":"open","priority":3,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:54:48.048772+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:48.048772+03:00","dependencies":[{"issue_id":"benefit-market-hwg.4","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:48.049368+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.5","title":"Документация для защиты диплома","description":"Подготовить:\n\n1. Обновить README.md по итогам реализации (актуализировать если что-то изменилось).\n2. Описание архитектурных решений и обоснования (для текста диплома):\n   - Почему Next.js + Supabase.\n   - Почему shared schema multi-tenancy.\n   - Почему point_ledger (event sourcing lite).\n   - Сравнение с аналогами.\n3. Скриншоты ключевых экранов.\n4. Результаты нагрузочного тестирования.\n5. Описание ограничений MVP и план развития.","status":"open","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:51.688842+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:51.688842+03:00","dependencies":[{"issue_id":"benefit-market-hwg.5","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:51.689603+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-hwg.6","title":"Деплой демо-стенда","description":"Развернуть рабочий демо:\n\n1. Деплой Next.js на Vercel (или аналог).\n2. Supabase project для демо (отдельный от dev).\n3. Seed-данные: тестовая компания, 20+ сотрудников, 15+ льгот.\n4. Тестовые учётные записи: employee / hr / admin (пароли в .env).\n5. README с инструкцией как зайти и протестировать.\n6. Проверить всё работает: регистрация, каталог, заказ, импорт, дашборд.","status":"open","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:54:53.717213+03:00","created_by":"ayugunin","updated_at":"2026-02-25T21:54:53.717213+03:00","dependencies":[{"issue_id":"benefit-market-hwg.6","depends_on_id":"benefit-market-hwg","type":"parent-child","created_at":"2026-02-25T21:54:53.717813+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-iv8","title":"Epic 5: Error Boundary and Polish","description":"## Epic 5: Error Boundary \u0026 Polish\n\n### Контекст\nПриложение не имеет error boundary — любая ошибка в рендере ломает весь dashboard. Нет badge корзины в сайдбаре, confirm/cancel заказов не работают в demo mode, иконка heart-pulse не маппится, HR не может экспортировать данные.\n\n### Задачи\n- 5.1 Create error boundary component (benefit-market-991)\n- 5.2 Wrap dashboard layout with ErrorBoundary (benefit-market-gjz)\n- 5.3 Cart badge in sidebar (benefit-market-gp6) — зависит от Epic 1\n- 5.4 Demo mode for confirm/cancel orders (benefit-market-de4)\n- 5.5 Fix category icon mapping heart-pulse (benefit-market-9wj)\n- 5.6 HR dashboard CSV export (benefit-market-7l7)\n\n### Верификация\n- Error boundary ловит ошибки и показывает fallback UI с retry\n- Badge корзины обновляется при добавлении товаров\n- Confirm/cancel работают в demo mode\n- Иконка heart-pulse рендерится для категории Здоровье\n- CSV скачивается с данными дашборда","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-25T23:54:32.201078+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:57:37.214817+03:00"}
{"id":"benefit-market-ivk","title":"Каталог льгот и кошельки баллов","description":"Недели 3-4. Каталог льгот с фильтрацией по eligibility rules, кошельки сотрудников, система баллов (budget policies, accrual), отображение баланса и истории транзакций.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-25T21:50:50.294863+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.534035+03:00","closed_at":"2026-02-25T22:31:07.534035+03:00","close_reason":"Каталог и кошельки полностью готовы","dependencies":[{"issue_id":"benefit-market-ivk","depends_on_id":"benefit-market-73a","type":"blocks","created_at":"2026-02-25T21:55:12.874469+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.1","title":"API: GET /api/benefits — каталог с фильтрацией","description":"Next.js API route GET /api/benefits:\n\n1. Извлечь user_id и tenant_id из JWT.\n2. Загрузить employee_profile текущего пользователя.\n3. Запросить benefits WHERE tenant_id AND is_active = true.\n4. Для каждой льготы проверить eligibility_rules.conditions против профиля (grade, tenure, location).\n5. Вернуть отфильтрованный список с пагинацией.\n\nQuery params: ?category_id=, ?search=, ?page=, ?per_page=\nResponse: { data: Benefit[], meta: { page, per_page, total } }\n\nZod-схема для query params. Обработка ошибок.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:52:47.126773+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.216906+03:00","closed_at":"2026-02-25T22:31:07.216906+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.1","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:47.127379+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.2","title":"UI: Страница каталога льгот с карточками","description":"Страница /dashboard/employee/benefits:\n\n- Шапка: поисковая строка + фильтр по категориям (tabs или select).\n- Сетка карточек: изображение/иконка, название, краткое описание, цена в баллах, категория.\n- Состояния: загрузка (skeleton), пустой результат, ошибка.\n- Пагинация или infinite scroll.\n- Клик по карточке → переход на детальную страницу.\n- Компоненты: BenefitCard, BenefitGrid, CategoryFilter, SearchInput.\n\nИспользовать shadcn/ui Card, Input, Tabs, Skeleton.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:52:49.585866+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.277511+03:00","closed_at":"2026-02-25T22:31:07.277511+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.2","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:49.586489+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.3","title":"UI: Детальная страница льготы","description":"Страница /dashboard/employee/benefits/[id]:\n\n- Полное описание льготы (rich text или markdown).\n- Цена в баллах (крупно).\n- Оставшийся stock (если есть лимит).\n- Кнопка 'Добавить в корзину' / 'В корзине'.\n- Показать текущий баланс кошелька для контекста.\n- Хлебные крошки: Каталог \u003e Категория \u003e Льгота.\n- Состояние если льгота недоступна (eligibility не пройдена) — показать 'Недоступна' без кнопки.\n\nAPI: GET /api/benefits/:id","status":"closed","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:51.920249+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.282096+03:00","closed_at":"2026-02-25T22:31:07.282096+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.3","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:51.920912+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.4","title":"Движок eligibility rules","description":"Реализовать проверку eligibility в lib/eligibility.ts:\n\nФункция: checkEligibility(profile: EmployeeProfile, rules: EligibilityRule[]): boolean\n\nФормат conditions (JSONB):\n{\n  grade: ['senior', 'middle'],  // IN check\n  min_tenure: 6,                // \u003e= check\n  location: ['Moscow', 'SPb'],  // IN check\n  legal_entity: ['ООО Тест']    // IN check\n}\n\nЛогика: ВСЕ условия должны быть true (AND). Если conditions пуст — льгота доступна всем.\nЕсли у benefit нет eligibility_rules — доступна всем.\n\nUnit-тесты для всех комбинаций.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:54.161037+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.2842+03:00","closed_at":"2026-02-25T22:31:07.2842+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.4","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:54.161629+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.5","title":"API: GET /api/wallets/me — баланс и история","description":"Next.js API route GET /api/wallets/me:\n\n1. Извлечь user_id из JWT.\n2. Найти активный wallet (текущий период, expires_at \u003e now()).\n3. Вернуть: balance, reserved, available (balance - reserved), period, expires_at.\n4. Вместе с последними N записями из point_ledger.\n\nQuery params: ?include_history=true, ?history_limit=50\nResponse: { data: { balance, reserved, available, period, expires_at, history?: LedgerEntry[] } }\n\nЕсли кошелька нет — вернуть balance: 0.","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:52:56.355386+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.286224+03:00","closed_at":"2026-02-25T22:31:07.286224+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.5","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:56.355963+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.6","title":"UI: Страница кошелька с историей транзакций","description":"Страница /dashboard/employee/wallet:\n\n- Крупный блок: текущий баланс, зарезервировано, доступно.\n- Дата сгорания баллов (expires_at).\n- Таблица/список транзакций: дата, тип (accrual/spend/reserve/release/expire), сумма (+/-), описание.\n- Цветовое кодирование: зелёный — начисление, красный — списание, серый — сгорание, жёлтый — резерв.\n- Фильтр по типу транзакции.\n\nКомпоненты: WalletBalance, TransactionList, TransactionRow.\nshadcn/ui: Card, Table, Badge.","status":"closed","priority":2,"issue_type":"task","estimated_minutes":120,"created_at":"2026-02-25T21:52:58.760139+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.288331+03:00","closed_at":"2026-02-25T22:31:07.288331+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.6","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:52:58.760881+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.7","title":"Budget policies: CRUD и применение","description":"Реализовать систему budget policies:\n\n1. Модель: budget_policies с target_filter (JSONB, аналогичен eligibility conditions).\n2. API для HR: просмотр политик своего tenant'а.\n3. Логика применения в lib/budget.ts:\n   - findApplicablePolicy(profile: EmployeeProfile, policies: BudgetPolicy[]): BudgetPolicy | null\n   - Если несколько подходят — берём с наибольшим points_amount (или приоритет).\n\nИспользуется в процессе начисления (accrual).","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2026-02-25T21:53:00.683069+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.291227+03:00","closed_at":"2026-02-25T22:31:07.291227+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.7","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:53:00.683664+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-ivk.8","title":"API: POST /api/wallets/accrual — начисление баллов","description":"Next.js API route POST /api/wallets/accrual:\n\nДоступ: hr, admin. Запускает начисление для всех сотрудников tenant'а.\n\nАлгоритм:\n1. Получить всех сотрудников tenant'а с employee_profiles.\n2. Получить активные budget_policies tenant'а.\n3. Для каждого сотрудника:\n   a. Найти подходящую policy (по target_filter).\n   b. Проверить: не было ли уже начисления за текущий период.\n   c. Если кошелька нет — создать (period = текущий квартал, expires_at = конец квартала).\n   d. Создать запись point_ledger type=accrual.\n   e. Увеличить wallets.balance.\n4. Всё в транзакции.\n\nResponse: { data: { processed: 50, accrued: 45, skipped: 5, errors: [] } }","status":"closed","priority":1,"issue_type":"task","estimated_minutes":150,"created_at":"2026-02-25T21:53:03.705651+03:00","created_by":"ayugunin","updated_at":"2026-02-25T22:31:07.293349+03:00","closed_at":"2026-02-25T22:31:07.293349+03:00","close_reason":"API + UI каталога, кошелька, eligibility, budget policies реализованы","dependencies":[{"issue_id":"benefit-market-ivk.8","depends_on_id":"benefit-market-ivk","type":"parent-child","created_at":"2026-02-25T21:53:03.706284+03:00","created_by":"ayugunin"}]}
{"id":"benefit-market-of5","title":"3.1 Allow HR role in policies API GET","description":"## 3.1 Allow HR role in policies API GET\n\n### Файл\n`src/app/api/admin/policies/route.ts` (line 62)\n\n### Текущее состояние\n```typescript\nif (appUser.role !== 'admin') {\n  return NextResponse.json({ error: ... }, { status: 403 });\n}\n```\nHR пользователи получают 403 Forbidden при попытке просмотреть политики.\n\n### Что сделать\nИзменить проверку роли ТОЛЬКО для GET handler:\n```typescript\nif (appUser.role !== 'admin' \u0026\u0026 appUser.role !== 'hr') {\n  return NextResponse.json({ error: ... }, { status: 403 });\n}\n```\nPOST handler оставить только для admin.\n\n### Верификация\n- HR может GET /api/admin/policies → 200\n- HR не может POST /api/admin/policies → 403\n- Admin может GET и POST как прежде\n- Employee получает 403 на GET","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:22.655213+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:57:02.422681+03:00"}
{"id":"benefit-market-rbk","title":"3.2 Implement HR policies page","description":"## 3.2 Implement HR policies page\n\n### Файл\n`src/app/dashboard/hr/policies/page.tsx` (сейчас 7 строк — стаб)\n\n### Текущее состояние\n```tsx\nexport default function HrPoliciesPage() {\n  return (\n    \u003cdiv className='page-transition p-6'\u003e\n      \u003ch1 className='text-2xl font-heading font-bold'\u003eБюджетные политики\u003c/h1\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Что сделать\nRead-only таблица по паттерну admin/policies (файл admin/policies/page.tsx):\n1. 'use client' + fetch /api/admin/policies\n2. Таблица: Название, Баллов, Период, Фильтр группы, Статус (Badge active/inactive)\n3. DataTablePagination\n4. Loading state (Loader2 spinner)\n5. Empty state\n6. **НЕ** добавлять кнопки создания/редактирования/переключения — только просмотр\n\n### Паттерн (из admin/policies/page.tsx)\nИспользовать те же компоненты: Table, TableBody, TableCell, TableHead, TableHeader, TableRow, Badge, DataTablePagination, Loader2.\nИспользовать PERIOD_LABELS маппинг: monthly→Ежемесячно, quarterly→Ежеквартально, yearly→Ежегодно.\nИспользовать formatFilter для отображения target_filter.\n\n### Верификация\n- HR видит список политик в табличном виде\n- Пагинация работает (\u003e20 записей)\n- Loading spinner при загрузке\n- Сообщение при пустом списке\n- Нет кнопок редактирования","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T23:54:24.302159+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:57:12.598862+03:00"}
{"id":"benefit-market-t2x","title":"1.2 Connect add-to-cart on detail page","description":"## 1.2 Connect add-to-cart on detail page\n\n### Файл\n`src/app/dashboard/employee/catalog/[id]/page.tsx` (lines 231-235)\n\n### Текущее состояние\nКнопка `\u003cButton disabled={!canAfford \u0026\u0026 balance !== null}\u003eДобавить в корзину\u003c/Button\u003e` — нет onClick handler.\n\n### Что сделать\n1. Импортировать `useCartStore` из `@/lib/store/cart`\n2. Импортировать `toast` из `sonner`\n3. Получить `addItem` из стора\n4. Добавить onClick:\n   - `addItem({ id, name, price_points, category_name, category_icon })`\n   - `toast.success(...)`\n\n### Верификация\n- Клик на кнопку на детальной странице → товар в корзине\n- Кнопка disabled если баланс недостаточен","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-25T23:54:14.57716+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:56:32.690392+03:00"}
{"id":"benefit-market-xy6","title":"Epic 4: Admin Categories Page","description":"## Epic 4: Admin Categories Page\n\n### Контекст\nАдминистратор не может управлять категориями льгот через UI. API /api/admin/categories имеет только GET и POST, нет PATCH/DELETE. Нет страницы управления категориями в дашборде и нет пункта в сайдбаре.\n\n### Задачи\n- 4.1 Add PATCH/DELETE to categories API (benefit-market-8wa)\n- 4.2 Create admin categories page (benefit-market-0cf)\n- 4.3 Add Categories to admin sidebar (benefit-market-4op)\n\n### Верификация\n- Пункт 'Категории' в admin sidebar\n- CRUD работает: создание, редактирование, удаление категорий\n- Паттерн UI совпадает с admin/benefits","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-25T23:54:25.827378+03:00","created_by":"ayugunin","updated_at":"2026-02-25T23:57:18.517954+03:00"}
