# Результаты брейншторма

## 1. Система начисления бонусов: когда и как начислять?

### Проблема

Нужно балансировать между двумя рисками:
- **Риск для компании:** Сотрудник получает бонусы, покупает льготы и увольняется → перерасход бюджета
- **Риск для сотрудника:** Слишком долго копит баллы → низкая мотивация и вовлечённость

### Вариант A: «Вестинг» (Постепенное накопление прав)

**Суть:** Баллы начисляются сразу, но «разблокируются» постепенно.

| Стаж | Доступно к использованию |
|------|--------------------------|
| 0–3 мес. (испытательный) | 0% — баллы копятся, но не доступны |
| 3–6 мес. | 25% от накопленных |
| 6–12 мес. | 50% от накопленных |
| 12+ мес. | 100% — полный доступ |

**Плюсы:**
- Минимальный риск для компании в первые месяцы
- Сотрудник видит, что баллы накапливаются — есть мотивация остаться
- Прозрачный и понятный механизм

**Минусы:**
- Новые сотрудники могут чувствовать себя «ущемлёнными»
- Сложнее в реализации (нужен механизм вестинга)

**Техническая реализация:**
- Добавить поле `vesting_pct` к wallet или employee_profile
- Вычислять `available = balance * vesting_pct - reserved`
- Автоматически обновлять `vesting_pct` при изменении стажа

---

### Вариант B: «Отложенный старт» (Начисление после испытательного)

**Суть:** Баллы начинают начисляться только после прохождения испытательного срока.

| Стаж | Начисления |
|------|-----------|
| 0–3 мес. | Нет начислений |
| 3+ мес. | Стандартные начисления по политике |
| 3 мес. (бонус) | Единовременное «приветственное» начисление за первые 3 месяца |

**Плюсы:**
- Простая реализация — просто фильтр по стажу при начислении
- Чёткий и понятный порог
- «Приветственный бонус» компенсирует ожидание

**Минусы:**
- Первые 3 месяца сотрудник не вовлечён в систему льгот
- Может негативно влиять на onboarding-опыт

**Техническая реализация:**
- В `accrual.service.ts` → `processAccruals()` добавить проверку `tenure_months >= 3`
- Опционально: начислить ретроактивный бонус при достижении порога

---

### Вариант C: «Гибридный» (Начислять сразу, но с лимитами) — РЕКОМЕНДУЕМЫЙ

**Суть:** Баллы начисляются с первого дня, но есть лимит на расход.

| Стаж | Начисления | Максимум расхода в месяц |
|------|-----------|--------------------------|
| 0–3 мес. | 100% от политики | 30% от баланса |
| 3–6 мес. | 100% от политики | 60% от баланса |
| 6+ мес. | 100% от политики | 100% от баланса |

**Плюсы:**
- Сотрудник вовлечён с первого дня — может выбирать недорогие льготы
- Компания защищена от массовой закупки в первые месяцы
- Баланс хорошо растёт — к моменту снятия лимитов можно купить что-то существенное
- Плавный переход, без ощущения «дискриминации»

**Минусы:**
- Сложнее объяснить сотрудникам
- Нужен UI для отображения лимитов

**Техническая реализация:**
- Добавить `spending_limit_pct` в wallet или profile
- В `order.service.ts` → `createOrder()` добавить проверку лимита
- В UI каталога показывать «доступно для заказа» с учётом лимита

---

### Вариант D: «Категорийный доступ»

**Суть:** Новички имеют доступ только к определённым категориям льгот.

| Стаж | Доступные категории |
|------|-------------------|
| 0–3 мес. | Только базовые (обучение, спорт) — до 2000 баллов |
| 3–6 мес. | Базовые + расширенные (здоровье, питание) |
| 6+ мес. | Все категории без ограничений |

**Плюсы:**
- Естественное ограничение — дорогие льготы обычно в «премиум» категориях
- Не нужно лимитировать суммы — ограничение через ассортимент
- Интуитивно понятно сотрудникам

**Минусы:**
- Сложнее настраивать (HR нужно классифицировать категории по уровням)
- Может не работать, если в «базовых» категориях есть дорогие опции

**Техническая реализация:**
- Добавить `min_tenure_months` к `benefit_categories` или `eligibility_rules`
- В каталоге фильтровать по стажу
- Показывать «заблокированные» категории с информацией о разблокировке

---

### Сравнительная таблица

| Критерий | A: Вестинг | B: Отложенный | C: Гибридный | D: Категорийный |
|----------|-----------|--------------|-------------|-----------------|
| Защита компании | Высокая | Высокая | Средняя | Средняя |
| Вовлечённость новичков | Средняя | Низкая | Высокая | Средняя |
| Простота для сотрудника | Средняя | Высокая | Средняя | Высокая |
| Сложность реализации | Средняя | Низкая | Средняя | Средняя |
| Гибкость настройки | Низкая | Низкая | Высокая | Высокая |

### Рекомендация

**Вариант C (Гибридный)** — лучший баланс между защитой компании и вовлечённостью сотрудников. Сотрудник с первого дня чувствует себя частью системы, может выбирать доступные льготы, при этом компания защищена от злоупотреблений. К 6 месяцам стажа все ограничения снимаются.

Для MVP можно начать с **Варианта B (Отложенный старт)** — проще всего реализовать, а затем перейти к гибридной модели.

---

## 2. Объединение вкладок «Аналитика» и «Дашборд»

### Текущая ситуация

Сейчас существуют две отдельные страницы:

| Страница | URL | Что показывает |
|----------|-----|---------------|
| **Дашборд** (`/dashboard/hr/`) | Главная HR | 4 карточки метрик, ТОП-5 льгот, категории (пирог), тренд 6 мес. |
| **Аналитика** (`/dashboard/hr/analytics`) | Отдельная | Утилизация (общая + по отделам/грейдам), Вовлечённость, Категории, ТОП-10 |

### Дублирование

| Метрика | Дашборд | Аналитика |
|---------|---------|-----------|
| Всего сотрудников | Есть | Есть |
| Активных сотрудников | Есть | Есть |
| Утилизация % | Есть | Есть |
| Потрачено баллов | Есть | Есть (как «Потрачено») |
| Популярные льготы | ТОП-5 (бар-чарт) | ТОП-10 (таблица) |
| Категории (пирог) | Есть | Есть |
| Тренд по месяцам | Начислено/Потрачено | Утилизация по месяцам |

Дублирование значительное — около 70% данных повторяются.

### Предложение: Единая страница с секциями

Объединить в одну страницу **«Аналитика»** (`/dashboard/hr/analytics` или сделать главной `/dashboard/hr/`):

```
┌──────────────────────────────────────────────────┐
│ Аналитика                                        │
├──────────────────────────────────────────────────┤
│                                                  │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐│
│  │Сотрудн. │ │Активных │ │Использ. │ │Потрачено││
│  │   156   │ │  89/156 │ │бюджета  │ │  45 200 ││
│  │         │ │  57%    │ │  62%    │ │ баллов  ││
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘│
│                                                  │
│  ┌── Тренд начислений и расходов ──────────────┐ │
│  │  [Area Chart: 6 мес., Начислено/Потрачено]  │ │
│  └─────────────────────────────────────────────┘ │
│                                                  │
│  ┌── По отделам ─────┐ ┌── По грейдам ────────┐ │
│  │ [Утилизация %]    │ │ [Утилизация %]       │ │
│  │ [Бар-чарт]        │ │ [Бар-чарт]           │ │
│  └───────────────────┘ └──────────────────────┘ │
│                                                  │
│  ┌── Вовлечённость ──┐ ┌── Категории ─────────┐ │
│  │ [По отделам]      │ │ [Pie + Тренд]        │ │
│  │ [Grouped Bar]     │ │                       │ │
│  └───────────────────┘ └──────────────────────┘ │
│                                                  │
│  ┌── Популярные льготы ────────────────────────┐ │
│  │  [Таблица ТОП-10]                          │ │
│  └─────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────┘
```

### Преимущества объединения

1. **Единая точка входа** — HR не нужно переключаться между страницами
2. **Контекст на одном экране** — метрики рядом с детализацией
3. **Нет дублирования** — каждый виджет в одном экземпляре
4. **Проще навигация** — одна ссылка в сайдбаре вместо двух

### План реализации

1. Сделать `/dashboard/hr/` (главную) единой страницей аналитики
2. Объединить данные из `generateDashboard()` и `generateAnalytics()` в один API-запрос
3. Использовать секции с заголовками и возможностью свернуть/развернуть
4. Удалить отдельную страницу `/dashboard/hr/analytics`
5. Обновить навигацию в сайдбаре

### Дополнительные улучшения

- **Фильтры:** Добавить общий фильтр по периоду (последние 3/6/12 месяцев) наверху страницы
- **Экспорт:** Кнопка экспорта в CSV/PDF для отчётности
- **Интерактивность:** Клик по отделу в одном графике фильтрует все остальные
